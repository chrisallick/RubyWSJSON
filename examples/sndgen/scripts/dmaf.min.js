var dmaf=function(e){function t(e,t,i){return e&&t&&i?k?null:(n(e,t,i),void 0):(console.log(r()),null)}function n(e,t,n){x[e]=n,n.deps=t,n.name=e}function r(){return"Dinahmoe Web Audio Framework version: "+S}function i(e){return T[e]||(s([e]),T[e]||{})}function s(e){for(var n,r=0,i=e.length;i>r;r++)if(n=e[r],!T[n]&&x[n]){if(!x[n].deps)return t.log&&console.log(n,"is undefined"),null;s.call(t,x[n].deps),T[n]=x[n].apply(t,o(x[n].deps))||{}}}function o(e){for(var t=[],n=0;e.length>n;n++)t.push(T[e[n]]);return t}function u(e){e&&(C.assetsPath=e),t.dev&&C.projectPath?l(C.projectPath+"project.xml","document",c):a(),t.init=function(){t.log&&console.log("dmaf has already been initialized.")}}function a(){var e=i("DMAF");return y&&!b?m("dmaf_ready"):(e.Settings=C,e.require=i,e.registeredModules=x,e.require("init"),void 0)}function f(e,t){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.async=!0,n.onload=function(){t(),setTimeout(function(){document.body.removeChild(n)},1)},n.src=e,document.body.appendChild(n)}function l(e,t,n){var r=new XMLHttpRequest;r.responseType=t,r.onload=function(){n(this.response)},r.open("GET",e,!0),r.send()}function c(e){var t=e.querySelector("framework"),n=e.querySelector("include");if(t=t&&t.getAttribute("path"),n=n&&n.getAttribute("scripts"),!t)throw new TypeError("Missing framework path.");C.customScripts=n&&n.split(",")||[],C.frameworkPath=t,C.configPath=C.projectPath+"config.xml",C.assetsPath=C.projectPath+"assets/";for(var r=0;C.customScripts.length>r;r++)C.customScripts[r]=C.assetsPath+"js/"+C.customScripts[r];l(t+"src/scripts.json","text",h)}function h(e){var t,n=JSON.parse(e);n=n.concat(C.customScripts),C.files.toLoad=n.length,k=!1,console.log("Loading dmaf from:",C.frameworkPath);for(var r=0;C.files.toLoad>r;r++)t=/http/.test(n[r])?n[r]:C.frameworkPath+n[r],f(t,p)}function p(){++C.files.loaded===C.files.toLoad&&l(C.frameworkPath+"src/xml/descriptors.xml","document",d)}function d(e){C.descriptorsXML=e,l(C.configPath,"document",v)}function v(e){C.configXML=e,a()}function m(e){var n=function(){},r=i("DMAF");i("public"),r.resolveListeners(),t.init=n,r.dispatch(e||"dmaf_fail")}function g(e){var n=[],r=function(){n.push(arguments)};r.resolve=function(r){for(t[e]=r||function(){};n.length;)r.apply(t,n.shift())},t[e]=r}for(var y="undefined"!=typeof window&&!!e.navigator&&!!e.document,b=y&&(!!e.webkitAudioContext||!!e.AudioContext),w=e.location&&e.location.href.split("?")||[],E=(!!Object.create&&!!Object.keys,/^dmaf\=/),S="4.2.4",x={},T={},N=["once","registerObject","unregisterObject","addEventListener","removeEventListener","tell","stop"],C={files:{loaded:0,total:0},projectPath:""},k=!1,L=0;N.length>L;L++)g(N[L]);for(t.prototype=null,t.isBrowser=y,t.hasContext=b,t.failure=m,t.toString=r,t.init=u,t.dev=!1,L=0;w.length>L;L++)if(E.test(w[L])){console.log("DMAF is running in development mode."),t.dev=k=!0,C.projectPath=w[L].replace(E,"");break}return"undefined"!=typeof module&&module.exports?module.exports=t:"undefined"!=typeof define&&define("dmaf",[],function(){return t}),y&&(window.dmaf=t),t}(this,"function");dmaf("settings",["DMAF"],function(e){e.Settings={assetsPath:"./dmaf_assets/",descriptors:{validActions:["loadCustomCode","loadSound","loadMIDI","loadSampleMap","customCode","userObject","mediaElement","mediaController","genericPlay","stepPlay","soundStop","midiProcessor","makeNote","transform","macro","state","eventMapper","midiNoteMapper","timePatternPlayer","beatPatternPlayer","sampler","audioBus"],validTypes:["noteMap","stateMap","eventMap","file","map","target","sampleMapGroup","sampleMap","start","stop","beatEvent","add","band","chorus","overdrive","compressor","cabinet","filter","convolver","delay","envelopeFollower","equalizer","lfo","phaser","pingPongDelay","tremolo","wahWah"],action:{assetController:{loadCustomCode:{type:"assetController",id:"loadCustomCode",instanceId:{name:"instanceId",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"},"":{type:"assetController"}},type:"assetController",loadSound:{type:"assetController",id:"loadSound",instanceId:{name:"instanceId",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"},"":{type:"assetController"}},loadMIDI:{type:"assetController",id:"loadMIDI",instanceId:{name:"instanceId",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"},"":{type:"assetController"}},loadSampleMap:{type:"assetController",id:"loadSampleMap",instanceId:{name:"instanceId",type:"string"},returnEvent:{name:"returnEvent",type:"string"},files:{name:"files",type:"array",valueType:"file"},"":{type:"assetController"}}},customCode:{customCode:{type:"customCode",id:"customCode",instanceId:{name:"instanceId",type:"string"},"":{type:"customCode"}},type:"customCode",userObject:{type:"customCode",id:"userObject",instanceId:{name:"instanceId",type:"string"},"":{type:"customCode"}}},mediaElement:{mediaElement:{type:"mediaElement",id:"mediaElement",instanceId:{name:"instanceId",type:"string"},"":{type:"mediaElement"}},type:"mediaElement"},control:{mediaController:{type:"control",id:"mediaController",instanceId:{name:"instanceId",type:"string","default":"multi"},"":{type:"control"}},type:"control"},sound:{genericPlay:{type:"sound",id:"genericPlay",delay:{name:"delay",type:"int","default":0,min:-1e6,max:1e6},instanceId:{name:"instanceId",type:"string","default":"multi"},soundFile:{name:"soundFile",type:"string","default":"multi"},multiSuffix:{name:"multiSuffix",type:"string","default":""},volume:{name:"volume",type:"float",unit:"dB","default":0,min:-90,max:48},pan:{name:"pan",type:"int","default":0,min:-100,max:100},loop:{name:"loop",type:"int",unit:"mS","default":-1,min:-2,max:1e5},reTrig:{name:"reTrig",type:"int",unit:"mS","default":-1,min:-1,max:1e5},returnEvent:{name:"returnEvent",type:"string"},returnEventTime:{name:"returnEventTime",type:"int",unit:"mS","default":-1,min:-1e6,max:1e5},preListen:{name:"preListen",type:"int","default":0,min:0,max:500},bus:{name:"bus",type:"string","default":"master"},priority:{name:"priority",type:"boolean","default":!1},timingCorrection:{name:"timingCorrection",type:"enum","default":"PLAY",values:["RESYNC","SYNC","PLAY"]},"":{type:"sound"}},type:"sound",stepPlay:{type:"sound",id:"stepPlay",delay:{name:"delay",type:"int","default":0,min:0,max:1e5},instanceId:{name:"instanceId",type:"string"},soundFiles:{name:"soundFiles",type:"list"},generator:{name:"generator",type:"enum","default":"SHUFFLE",values:["SHUFFLE","RANDOM","RANDOM_FIRST","ROUND_ROBIN"]},volume:{name:"volume",type:"float","default":0,min:-90,max:48},pan:{name:"pan",type:"int","default":0,min:-100,max:100},reTrig:{name:"reTrig",type:"int","default":-1,min:-1,max:1e5},returnEvent:{name:"returnEvent",type:"string","default":"",values:["ALL"]},returnEventTime:{name:"returnEventTime",type:"int","default":-1,min:-1e6,max:1e5},preListen:{name:"preListen",type:"int","default":0,min:0,max:500},bus:{name:"bus",type:"string","default":"master",values:["ALL"]},priority:{name:"priority",type:"boolean","default":!1},timingCorrection:{name:"timingCorrection",type:"enum","default":"SYNC",values:["SYNC","PLAY"]},"":{type:"sound"}},soundStop:{type:"sound",id:"soundStop",delay:{name:"delay",type:"int","default":0,min:0,max:9999999},targets:{name:"targets",type:"list"},multiSuffix:{name:"multiSuffix",type:"string","default":""},"":{type:"sound"}}},midiProcessor:{midiProcessor:{type:"midiProcessor",id:"midiProcessor",instanceId:{name:"instanceId",type:"string"},transpose:{name:"transpose",type:"int","default":0,min:-127,max:127},dynamic:{name:"dynamic",type:"int","default":0,min:-127,max:127},quantize:{name:"quantize",type:"string"},scale:{name:"scale",type:"string",values:["off","major","harmonicMinor","naturalMinor","majorPentatonic","minorPentatonic","dorian","phyrgian","lydian","mixolydian","locrian","doubleHarmonic","halfDim","custom","off"]},customScale:{name:"customScale",type:"string","default":"0,0,0,0,0,0,0,0,0,0,0,0"},root:{name:"root",type:"string","default":"C",values:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]},"":{type:"midiProcessor"}},type:"midiProcessor",makeNote:{type:"midiProcessor",id:"makeNote",instanceId:{name:"instanceId",type:"string","default":"someProcessor"},reTrig:{name:"reTrig",type:"int","default":0,min:0,max:1e4},noteMaps:{name:"noteMaps",type:"array",valueType:"noteMap"},"":{type:"midiProcessor"}}},parameterProcessor:{transform:{type:"parameterProcessor",id:"transform",instanceId:{name:"instanceId",type:"string"},delay:{name:"delay",type:"int","default":0,min:0,max:9999999},targetType:{name:"targetType",type:"enum","default":"SOUND",values:["sound","audioRouter","synth"]},targets:{name:"targets",type:"list"},targetParameter:{name:"targetParameter",type:"string"},multiSuffix:{name:"multiSuffix",type:"string"},value:{name:"value",type:"float","default":0,min:-9999999,max:9999999},duration:{name:"duration",type:"int","default":0,min:0,max:9999999},curve:{name:"curve",type:"int","default":0,min:-100,max:100},"":{type:"parameterProcessor"}},type:"parameterProcessor",macro:{type:"parameterProcessor",id:"macro",instanceId:{name:"instanceId",type:"string"},delay:{name:"delay",type:"int","default":0,min:0,max:9999999},macroTargets:{name:"macroTargets",type:"array",valueType:"macroTarget"},"":{type:"parameterProcessor"}}},stateProcessor:{state:{type:"stateProcessor",id:"state",instanceId:{name:"instanceId",type:"string"},update:{name:"update",type:"enum","default":"onChange",values:["onChange","always"]},stateMaps:{name:"stateMaps",type:"array",valueType:"stateMap"},"":{type:"stateProcessor"}},type:"stateProcessor"},eventProcessor:{eventMapper:{type:"eventProcessor",id:"eventMapper",instanceId:{name:"instanceId",type:"string"},reTrig:{name:"reTrig",type:"int","default":0,min:0,max:1e4},eventMaps:{name:"eventMaps",type:"array",valueType:"eventMap"},"":{type:"eventProcessor"}},type:"eventProcessor",midiNoteMapper:{type:"eventProcessor",id:"midiNoteMapper",instanceId:{name:"instanceId",type:"string"},eventMaps:{name:"eventMaps",type:"array",valueType:"eventMap"},"":{type:"eventProcessor"}}},player:{timePatternPlayer:{type:"player",id:"timePatternPlayer",instanceId:{name:"instanceId",type:"string","default":"master_time_player"},behavior:{name:"behavior",type:"enum",values:["LINEAR","DEFAULT"],"default":"DEFAULT"},"":{type:"player"}},type:"player",beatPatternPlayer:{type:"player",id:"beatPatternPlayer",instanceId:{name:"instanceId",type:"string","default":"master_beat_player"},flowItems:{name:"flowItems",type:"array",valueType:"flowItem"},"":{type:"player"}}},synth:{sampler:{type:"synth",id:"sampler",instanceId:{name:"instanceId",type:"string"},ignoreNoteOff:{name:"ignoreNoteOff",type:"boolean","default":!1},bus:{name:"bus",type:"string","default":"master"},volume:{name:"volume",type:"float","default":0,min:-100,max:10},loop:{name:"loop",type:"boolean","default":!1},ampAttack:{name:"ampAttack",type:"int","default":0,min:0,max:500},ampDecay:{name:"ampDecay",type:"int","default":0,min:0,max:500},ampRelease:{name:"ampRelease",type:"int","default":0,min:0,max:1e3},ampSustain:{name:"ampSustain",type:"float","default":1,min:0,max:1},ampVelocityRatio:{name:"ampVelocityRatio",type:"float","default":1,min:0,max:1},filterOn:{name:"filterOn",type:"boolean","default":!1},filterAttack:{name:"filterAttack",type:"int","default":0,min:0,max:500},filterDecay:{name:"filterDecay",type:"int","default":0,min:0,max:500},filterRelease:{name:"filterRelease",type:"int","default":0,min:0,max:1e3},filterSustain:{name:"filterSustain",type:"float","default":1,min:0,max:1},filterVelocityRatio:{name:"filterVelocityRatio",type:"float","default":1,min:0,max:1},filterQ:{name:"filterQ",type:"float","default":1e-4,min:1e-4,max:30},filterFrequency:{name:"filterFrequency",type:"int","default":0,min:0,max:10},filterGain:{name:"filterGain",type:"float","default":0,min:0,max:1},audioNodes:{name:"audioNodes",type:"array",valueType:"audioNode"},sampleMapGroups:{name:"sampleMapGroups",type:"array",valueType:"sampleMapGroup"},"":{type:"synth"}},type:"synth"},audioRouter:{audioBus:{type:"audioRouter",id:"audioBus",instanceId:{name:"instanceId",type:"string"},outputBus:{name:"outputBus",type:"string","default":"master"},volume:{name:"volume",type:"float","default":0,min:-100,max:10},pan:{name:"pan",type:"int","default":0,min:-100,max:100},audioNodes:{name:"audioNodes",type:"array",valueType:"audioNode"},"":{type:"audioRouter"}},type:"audioRouter"}},type:{noteMap:{noteMap:{type:"noteMap",id:"noteMap",triggerIn:{name:"triggerIn",type:"string"},triggerOut:{name:"triggerOut",type:"string"},note:{name:"note",type:"string","default":"C4"},velocity:{name:"velocity",type:"int",min:0,max:127,"default":127},duration:{name:"duration",type:"int",min:0,max:9999999,"default":0},"":{type:"noteMap"}},type:"noteMap"},stateMap:{stateMap:{type:"stateMap",id:"stateMap","in":{name:"in",type:"list"},state:{name:"state",type:"string"},"":{type:"stateMap"}},type:"stateMap"},eventMap:{eventMap:{type:"eventMap",id:"eventMap","in":{name:"in",type:"list"},out:{name:"out",type:"string"},delay:{name:"delay",type:"int","default":0,max:1e4,min:0},"":{type:"eventMap"}},type:"eventMap"},file:{file:{type:{name:"type",type:"enum",values:["beatPattern","timePattern"],"default":""},id:"file",name:{name:"name",type:"string"},"":{type:"file"}},type:"file"},map:{map:{type:"map",id:"map",inValue:{name:"inValue",type:"string"},outValue:{name:"outValue",type:"string"},"":{type:"map"}},type:"map"},macroTarget:{target:{type:"macroTarget",id:"target",targetId:{name:"targetId",type:"string"},min:{name:"min",type:"float","default":0,min:0,max:1},max:{name:"max",type:"float","default":1,min:0,max:1},targetType:{name:"targetType",type:"enum","default":"BUS",values:["SOUND","SYNTH","BUS"]},targetParameter:{name:"targetParameter",type:"string"},"":{type:"macroTarget"}},type:"macroTarget"},sampleMapGroup:{sampleMapGroup:{type:"sampleMapGroup",id:"sampleMapGroup",name:{name:"name",type:"string"},sampleMaps:{name:"sampleMaps",type:"array",valueType:"sampleMap"},"":{type:"sampleMapGroup"}},type:"sampleMapGroup"},sampleMap:{sampleMap:{type:"sampleMap",id:"sampleMap",name:{name:"name",type:"string"},velocityLow:{name:"velocityLow",type:"int","default":0,min:0,max:127},velocityHigh:{name:"velocityHigh",type:"int","default":127,min:0,max:127},"":{type:"sampleMap"}},type:"sampleMap"},flowItem:{start:{type:"flowItem",id:"start",delay:{name:"delay",type:"int","default":0,min:0,max:null},tempo:{name:"tempo",type:"float","default":120,min:40,max:280},beatsPerBar:{name:"beatsPerBar",type:"int","default":16,min:1,max:16},meter:{name:"meter",type:"list","default":["simple"],value:["simple","compound"]},subdivision:{name:"subdivision",type:"string","default":"16",values:["1","2D","2","2T","4D","4","4T","8D","8","8T","16D","16","16T","32D","32","32T"]},"":{type:"flowItem"}},type:"flowItem",stop:{type:"flowItem",id:"stop",songPosition:{name:"songPosition",type:"string","default":"NEXT_BEAT"},returnEvent:{name:"returnEvent",type:"string"},"":{type:"flowItem"}},beatEvent:{type:"flowItem",id:"beatEvent",songPosition:{name:"songPosition",type:"string","default":"NEXT_BEAT"},returnEvent:{name:"returnEvent",type:"string"},output:{name:"output",type:"enum","default":"onEvent",values:["dispatch","onEvent"]},"":{type:"flowItem"}},add:{type:"flowItem",id:"add",patternId:{name:"patternId",type:"string","default":"multi"},channel:{name:"channel",type:"string","default":"main"},songPosition:{name:"songPosition",type:"string","default":"NEXT_BAR"},patternPosition:{name:"patternPosition",type:"enum","default":"SYNC",values:["SYNC","FIRST_BEAT"]},clearPending:{name:"clearPending",type:"boolean","default":!0},replaceActive:{name:"replaceActive",type:"boolean","default":!0},setAsCurrent:{name:"setAsCurrent",type:"boolean","default":!0},loop:{name:"loop",type:"boolean","default":!1},loopLength:{name:"loopLength",type:"int","default":129,min:1,max:65536},clearPosition:{name:"clearPosition",type:"string","default":"NEXT_BAR"},"":{type:"flowItem"}}},band:{band:{type:"band",id:"band",bandType:{name:"bandType",type:"enum","default":"PEAKING",values:["LOWPASS","HIGHPASS","BANDPASS","LOWSHELF","HIGHSHELF","PEAKING","NOTCH","ALLPASS"],automatable:!1},frequency:{name:"frequency",type:"float","default":800,min:20,max:22050,automatable:!0},Q:{name:"Q",type:"float","default":1,min:0,max:100,automatable:!0},gain:{name:"gain",type:"float","default":0,min:-40,max:40,automatable:!0},"":{type:"band"}},type:"band"},audioNode:{chorus:{type:"audioNode",id:"chorus",active:{name:"active",type:"boolean","default":!0},feedback:{name:"feedback",type:"float","default":0,min:0,max:1,automatable:!1},delay:{name:"delay",type:"float","default":.0045,min:0,max:1,automatable:!1},rate:{name:"rate",type:"float","default":1.5,min:.01,max:8,automatable:!1},bypass:{name:"bypass",type:"float","default":0,min:0,max:1,automatable:!1},"":{type:"audioNode"}},type:"audioNode",overdrive:{type:"audioNode",id:"overdrive",active:{name:"active",type:"boolean","default":!0},outputGain:{name:"outputGain",type:"float","default":0,min:0,max:1,automatable:!0},drive:{name:"drive",type:"float","default":0,min:0,max:1,automatable:!0},curveAmount:{name:"curveAmount",type:"float","default":1,min:0,max:1,automatable:!0},algorithmIndex:{name:"algorithmIndex",type:"int","default":0,min:0,max:5,automatable:!1},"":{type:"audioNode"}},compressor:{type:"audioNode",id:"compressor",active:{name:"active",type:"boolean","default":!0},threshold:{name:"threshold",type:"float","default":0,min:-100,max:0,automatable:!0},makeupGain:{name:"makeupGain",type:"float","default":1,min:0,max:100,automatable:!0},attack:{name:"attack",type:"float","default":1,min:0,max:1e3,automatable:!0},release:{name:"release",type:"float","default":1,min:0,max:3e3,automatable:!0},ratio:{name:"ratio",type:"float","default":4,min:1,max:20,automatable:!0},knee:{name:"knee",type:"float","default":5,min:0,max:40,automatable:!0},automakeup:{name:"automakeup",type:"boolean","default":!1},"":{type:"audioNode"}},cabinet:{type:"audioNode",id:"cabinet",active:{name:"active",type:"boolean","default":!0},makeupGain:{name:"makeupGain",type:"float","default":1,min:0,max:20,automatable:!0},impulsePath:{name:"impulsePath",type:"string"},"":{type:"audioNode"}},filter:{type:"audioNode",id:"filter",active:{name:"active",type:"boolean","default":!0},frequency:{name:"frequency",type:"float","default":20,min:20,max:22050,automatable:!0},Q:{name:"Q",type:"float","default":1,min:0,max:100,automatable:!0},gain:{name:"gain",type:"float","default":0,min:-40,max:40,automatable:!0},bypass:{name:"bypass",type:"boolean","default":!0,automatable:!0},filterType:{name:"filterType",type:"enum","default":"LOWPASS",values:["LOWPASS","HIGHPASS","BANDPASS","LOWSHELF","HIGHSHELF","PEAKING","NOTCH","ALLPASS"],automatable:!1},"":{type:"audioNode"}},convolver:{type:"audioNode",id:"convolver",active:{name:"active",type:"boolean","default":!0},highCut:{name:"highCut",type:"float","default":22050,min:20,max:22050,automatable:!0},lowCut:{name:"lowCut",type:"float","default":20,min:20,max:22050,automatable:!0},dryLevel:{name:"dryLevel",type:"float","default":1,min:0,max:1,automatable:!0},wetLevel:{name:"wetLevel",type:"float","default":1,min:0,max:1,automatable:!0},level:{name:"level",type:"float","default":1,min:0,max:1,automatable:!0},impulse:{name:"impulse",type:"string"},"":{type:"audioNode"}},delay:{type:"audioNode",id:"delay",active:{name:"active",type:"boolean","default":!0},delayTime:{name:"delayTime",type:"float","default":30,min:.001,max:1e4,automatable:!1},feedback:{name:"feedback",type:"float","default":.45,min:0,max:.9,automatable:!0},cutoff:{name:"cutoff",type:"float","default":20,min:20,max:22050,automatable:!0},dryLevel:{name:"dryLevel",type:"float","default":1,min:0,max:1,automatable:!0},wetLevel:{name:"wetLevel",type:"float","default":1,min:0,max:1,automatable:!0},tempoSync:{name:"tempoSync",type:"string",automatable:!1},subdivision:{name:"subdivision",type:"enum","default":"8D",values:["1","2D","2","2T","4D","4","4T","8D","8","8T","16D","16","16T","32D","32","32T"],automatable:!1},"":{type:"audioNode"}},envelopeFollower:{type:"audioNode",id:"envelopeFollower",active:{name:"active",type:"boolean","default":!0},attackTime:{name:"attackTime",type:"float","default":.003,min:0,max:.5,automatable:!1},releaseTime:{name:"releaseTime",type:"float","default":.5,min:0,max:1,automatable:!1},"":{type:"audioNode"}},equalizer:{type:"audioNode",id:"equalizer",active:{name:"active",type:"boolean","default":!0},bands:{name:"bands",type:"array",valueType:"band"},"":{type:"audioNode"}},lfo:{type:{name:"type",type:"enum","default":"SIN",values:["SIN","SQUARE","TRIANGLE","SAWTOOTH"],automatable:!1},id:"lfo",active:{name:"active",type:"boolean","default":!0},frequency:{name:"frequency",type:"float","default":1,min:0,max:8,automatable:!1},offset:{name:"offset",type:"float","default":.85,min:0,max:22050,automatable:!1},phase:{name:"phase",type:"float","default":0,min:0,max:6.28318530718,automatable:!1},oscillation:{name:"oscillation",type:"float","default":.3,min:-22050,max:22050,automatable:!1},"":{type:"audioNode"}},phaser:{type:"audioNode",id:"phaser",active:{name:"active",type:"boolean","default":!0},rate:{name:"rate",type:"float","default":1,min:0,max:8,automatable:!1},depth:{name:"depth",type:"float","default":.3,min:0,max:1,automatable:!1},feedback:{name:"feedback",type:"float","default":.2,min:0,max:1,automatable:!1},stereoPhase:{name:"stereoPhase",type:"int","default":30,min:0,max:180,automatable:!1},baseModulationFrequency:{name:"baseModulationFrequency",type:"float","default":700,min:500,max:1500,automatable:!1},"":{type:"audioNode"}},pingPongDelay:{type:"audioNode",id:"pingPongDelay",active:{name:"active",type:"boolean","default":!0},delayTime:{name:"delayTime",type:"float","default":30,min:1e-4,max:1e4,automatable:!1},feedback:{name:"feedback",type:"float","default":.45,min:0,max:.9,automatable:!0},cutoff:{name:"cutoff",type:"float","default":20,min:20,max:22050,automatable:!0},dryLevel:{name:"dryLevel",type:"float","default":1,min:0,max:1,automatable:!0},wetLevel:{name:"wetLevel",type:"float","default":1,min:0,max:1,automatable:!0},tempoSync:{name:"tempoSync",type:"string",automatable:!1},subdivision:{name:"subdivision",type:"enum","default":"8D",values:["1","2D","2","2T","4D","4","4T","8D","8","8T","16D","16","16T","32D","32","32T"],automatable:!1},"":{type:"audioNode"}},tremolo:{type:"audioNode",id:"tremolo",active:{name:"active",type:"boolean","default":!0},intensity:{name:"intensity",type:"float","default":.3,min:0,max:1,automatable:!1},stereoPhase:{name:"stereoPhase",type:"int","default":0,min:0,max:180,automatable:!1},rate:{name:"rate",type:"float","default":.1,min:.001,max:8,automatable:!1},"":{type:"audioNode"}},wahWah:{type:"audioNode",id:"wahWah",active:{name:"active",type:"boolean","default":!0},automode:{name:"automode",type:"boolean","default":!1},baseFrequency:{name:"baseFrequency",type:"float","default":.5,min:0,max:1,automatable:!1},excursionOctaves:{name:"excursionOctaves",type:"int","default":2,min:1,max:6,automatable:!1},sweep:{name:"sweep",type:"float","default":.2,min:0,max:1,automatable:!1},resonance:{name:"resonance",type:"float","default":10,min:1,max:100,automatable:!1},sensitivity:{name:"sensitivity",type:"float","default":.5,min:-1,max:1,automatable:!1},"":{type:"audioNode"}}}}},actions:[{type:"assetController",id:"loadSampleMap",triggers:["preload_assets"],actionProperties:{instanceId:"sampleMaps",files:[{id:"file",name:"samplemaps"}]},delay:0,instanceId:""},{type:"assetController",id:"loadMIDI",triggers:["preload_assets"],actionProperties:{instanceId:"midiFiles",files:[{id:"file",name:"p1"},{id:"file",name:"p2"},{id:"file",name:"p3"},{id:"file",name:"p4"}]},delay:0,instanceId:""},{type:"assetController",id:"loadSound",triggers:["preload_assets"],actionProperties:{instanceId:"keys",files:[{id:"file",name:"snare2"},{id:"file",name:"snare1"},{id:"file",name:"openhihat"},{id:"file",name:"kick"},{id:"file",name:"closedhihat"},{id:"file",name:"808hihat"},{id:"file",name:"pad1_D3"},{id:"file",name:"pad1_G3"},{id:"file",name:"pad1_D4"},{id:"file",name:"pad1_G4"},{id:"file",name:"pad1_D5"},{id:"file",name:"pad2_A3"},{id:"file",name:"pad2_D4"},{id:"file",name:"pad2_G4"},{id:"file",name:"pad2_D5"},{id:"file",name:"pad2_F5"},{id:"file",name:"harpgsp_Cs2"},{id:"file",name:"harpgsp_E2"},{id:"file",name:"harpgsp_G2"},{id:"file",name:"harpgsp_A2"},{id:"file",name:"harpgsp_C3"},{id:"file",name:"harpgsp_E3"},{id:"file",name:"harpgsp_G3"},{id:"file",name:"harpgsp_A3"},{id:"file",name:"harpgsp_Cs4"},{id:"file",name:"harpgsp_E4"},{id:"file",name:"harpgsp_G4"},{id:"file",name:"harpgsp_A4"},{id:"file",name:"harpgsp_C5"},{id:"file",name:"vox_Fs2"},{id:"file",name:"vox_B2"},{id:"file",name:"vox_E3"},{id:"file",name:"vox_G3"},{id:"file",name:"vox_B3"},{id:"file",name:"vox_D4"},{id:"file",name:"moog_bass_A2"},{id:"file",name:"moog_bass_A3"},{id:"file",name:"chopped_bass_A2"},{id:"file",name:"chopped_bass_A3"},{id:"file",name:"dirty_moog_A2"},{id:"file",name:"dirty_moog_A3"},{id:"file",name:"oberheim_p3_1"},{id:"file",name:"oberheim_p3_2"},{id:"file",name:"oberheim_p3_3"},{id:"file",name:"oberheim_p3_4"},{id:"file",name:"oberheim_p3_5"},{id:"file",name:"oberheim_p3_6"},{id:"file",name:"oberheim_p3_7"},{id:"file",name:"oberheim_p3_8"},{id:"file",name:"oberheim_p3_9"},{id:"file",name:"oberheim_p3_10"},{id:"file",name:"oberheim_p3_11"},{id:"file",name:"oberheim_p3_12"},{id:"file",name:"oberheim_p3_13"},{id:"file",name:"oberheim_p3_14"},{id:"file",name:"oberheim_p3_15"},{id:"file",name:"oberheim_p3_16"},{id:"file",name:"oberheim_p4_1"},{id:"file",name:"oberheim_p4_2"},{id:"file",name:"oberheim_p4_3"},{id:"file",name:"oberheim_p4_4"},{id:"file",name:"oberheim_p4_5"},{id:"file",name:"oberheim_p4_6"},{id:"file",name:"oberheim_p4_7"},{id:"file",name:"oberheim_p4_8"},{id:"file",name:"oberheim_p4_9"},{id:"file",name:"oberheim_p4_10"},{id:"file",name:"oberheim_p4_11"},{id:"file",name:"oberheim_p4_12"},{id:"file",name:"oberheim_p4_13"},{id:"file",name:"oberheim_p4_14"},{id:"file",name:"oberheim_p4_15"},{id:"file",name:"oberheim_p4_16"},{id:"file",name:"synth_arp_A5"},{id:"file",name:"synth_arp_As2"},{id:"file",name:"synth_arp_B4"},{id:"file",name:"synth_arp_C2"},{id:"file",name:"synth_arp_Cs4"},{id:"file",name:"synth_arp_D1"},{id:"file",name:"synth_arp_D6"},{id:"file",name:"synth_arp_Ds3"},{id:"file",name:"synth_arp_E5"},{id:"file",name:"synth_arp_F2"},{id:"file",name:"synth_arp_Fs4"},{id:"file",name:"synth_arp_G1"},{id:"file",name:"synth_arp_G6"},{id:"file",name:"synth_arp_Gs3"}]},delay:0,instanceId:""},{type:"audioRouter",id:"audioBus",triggers:["init_routing"],actionProperties:{instanceId:"master_bus",outputBus:"master",volume:1,pan:0,audioNodes:[]},delay:0,instanceId:""},{type:"audioRouter",id:"audioBus",triggers:["init_routing"],actionProperties:{instanceId:"delay_bus",outputBus:"master_bus",volume:1,pan:0,audioNodes:[]},delay:0,instanceId:""},{type:"customCode",id:"userObject",triggers:["data.CREATE"],actionProperties:{instanceId:"data"},delay:0,instanceId:""},{type:"customCode",id:"customCode",triggers:["data.CREATE","drums1","drums2","drums3","pad1","pad2","harpgsp","vox","moog_bass","chopped_bass1","chopped_bass2","oberheim","synth_arp"],actionProperties:{instanceId:"controller"},delay:0,instanceId:""},{type:"player",id:"beatPatternPlayer",triggers:["start"],actionProperties:{instanceId:"main",flowItems:[{id:"start",delay:0,tempo:120,beatsPerBar:16}]},delay:0,instanceId:""},{type:"player",id:"beatPatternPlayer",triggers:["stop"],actionProperties:{instanceId:"main",flowItems:[{id:"stop"}]},delay:0,instanceId:""},{type:"player",id:"beatPatternPlayer",triggers:["p1","start"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"drums1_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums2_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums3_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad1_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad2_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"harpgsp_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"vox_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"moog_bass_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass1_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass2_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"oberheim_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_arp_p1",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0,instanceId:""},{type:"player",id:"beatPatternPlayer",triggers:["p2"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"drums1_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums2_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums3_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad1_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad2_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"harpgsp_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"vox_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"moog_bass_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass1_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass2_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"oberheim_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_arp_p2",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0,instanceId:""},{type:"player",id:"beatPatternPlayer",triggers:["p3"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"drums1_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums2_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums3_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad1_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad2_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"harpgsp_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"vox_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"moog_bass_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass1_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass2_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"oberheim_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_arp_p3",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0,instanceId:""},{type:"player",id:"beatPatternPlayer",triggers:["p4"],actionProperties:{instanceId:"main",flowItems:[{id:"add",patternId:"drums1_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums2_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"drums3_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad1_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"pad2_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"harpgsp_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"vox_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"moog_bass_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass1_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"chopped_bass2_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"oberheim_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"},{id:"add",patternId:"synth_arp_p4",channel:"main",songPosition:"NEXT_BAR",patternPosition:"FIRST_BEAT",clearPending:!1,replaceActive:!1,setAsCurrent:!0,loop:!0,loopLength:128,clearPosition:"NEXT_BAR"}]},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["drums1"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"output_bus",volume:0,loop:!1,ampAttack:0,ampDecay:10,ampRelease:40,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"drums",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["drums2"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"output_bus",volume:0,loop:!1,ampAttack:0,ampDecay:10,ampRelease:40,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"drums",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["drums3"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"output_bus",volume:0,loop:!1,ampAttack:0,ampDecay:10,ampRelease:40,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"drums",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["moog_bass"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"output_bus",volume:-3,loop:!1,ampAttack:0,ampDecay:10,ampRelease:10,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"moog_bass",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["chopped_bass1"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"output_bus",volume:-14,loop:!1,ampAttack:0,ampDecay:10,ampRelease:10,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"chopped_bass",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["chopped_bass2"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"output_bus",volume:-14,loop:!1,ampAttack:0,ampDecay:10,ampRelease:10,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"chopped_bass",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["pad1"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"delay_bus",volume:-16,loop:!1,ampAttack:0,ampDecay:10,ampRelease:400,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"pad1",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["pad2"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"delay_bus",volume:-9,loop:!1,ampAttack:0,ampDecay:10,ampRelease:400,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"pad2",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["vox"],actionProperties:{instanceId:"multi",ignoreNoteOff:!1,bus:"delay_bus",volume:-3,loop:!1,ampAttack:0,ampDecay:10,ampRelease:400,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"vox",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["harpgsp"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"delay_bus",volume:-6,loop:!1,ampAttack:0,ampDecay:10,ampRelease:40,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"harpgsp",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["oberheim"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"delay_bus",volume:-3,loop:!1,ampAttack:0,ampDecay:10,ampRelease:40,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"oberheim",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""},{type:"synth",id:"sampler",triggers:["synth_arp"],actionProperties:{instanceId:"multi",ignoreNoteOff:!0,bus:"delay_bus",volume:-9,loop:!1,ampAttack:0,ampDecay:10,ampRelease:40,ampSustain:1,ampVelocityRatio:1,filterOn:!1,audioNodes:[],sampleMapGroups:[{id:"sampleMapGroup",name:"group1",sampleMaps:[{id:"sampleMap",name:"synth_arp",velocityLow:0,velocityHigh:127}]}],filterAttack:0,filterDecay:0,filterRelease:0,filterSustain:1,filterVelocityRatio:1,filterQ:1e-4,filterFrequency:0,filterGain:0},delay:0,instanceId:""}]}}),dmaf("AudioNodes",["DMAF","Utils","Instance"],function(e,t,n){function r(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function i(e){return 0===e?1:Math.abs(e)/e}function s(e,t){var n,r,i=0,s=0,o=0,u=0;return n=e.toExponential().match(/^.\.?(.*)e(.+)$/),i=parseInt(n[2],10)-(n[1]+"").length,n=t.toExponential().match(/^.\.?(.*)e(.+)$/),s=parseInt(n[2],10)-(n[1]+"").length,s>i&&(i=s),r=e%t,-100>i||i>20?(o=Math.round(Math.log(r)/Math.log(10)),u=Math.pow(10,o),(r/u).toFixed(o-i)*u):parseFloat(r.toFixed(-i))}var o=Object.create(null),u={lowpass:0,highpass:1,bandpass:2,lowshelf:3,highshelf:4,peaking:5,notch:6,allpass:7},a={32:.125,"16T":.16666666666666666,"32D":.1875,16:.25,"8T":.3333333333333333,"16D":.375,8:.5,"4T":.6666666666666666,"8D":.75,4:1,"2T":1.3333333333333333,"4D":1.5,2:2,"2D":3,1:4},f=function(e,t){e.value=t},l=Object.create(n,{activate:{writable:!0,value:function(e){this.input.disconnect(),this._activated=e,e?(this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(e)):this.input.connect(this.output)}},bypass:{get:function(){return this._activated},set:function(e){this.activate(e)}},active:{get:function(){return this._activated},set:function(e){this.activate(e)}},connect:{value:function(e){this.output.connect(e)}},connectInOrder:{value:function(e){for(var t=e.length-1;t--;){if(!e[t].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",e[t]);e[t].connect(e[t+1])}}}});return o.createRecursive=function(e,n){for(var r,i,s=[],u=0;n.length>u;u++)r=n[u],i=new(o[t.capitalize(r.id)])(r),r.active?i.activate(!0):i.activate(!1),s.push(i),e.connect(i.input),e=i;return s},o.Filter=function(t){this.input=e.context.createGainNode(),this.filter=this.activateNode=e.context.createBiquadFilter(),this.output=e.context.createGainNode(),this.filter.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.filter,this.frequency=t.frequency,this.Q=t.resonance,this.filterType=t.filterType,this.gain=t.gain},o.Filter.prototype=Object.create(l,{name:{value:"Filter"},filterType:{enumerable:!0,get:function(){return this._filterType},set:function(e){this._filterType=e,this.filter.type=u[this._filterType.toLowerCase()]}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(e){this.filter.Q.value=e}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(e){this.filter.gain.value=e}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=e}}}),o.Cabinet=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.convolver=this.newConvolver(t.impulsePath),this.makeupNode=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.cabinet,this.makeupGain=t.makeupGain,this.convolver.activate(!0)},o.Cabinet.prototype=Object.create(l,{name:{value:"Cabinet"},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){this.makeupNode.gain.value=e}},newConvolver:{value:function(e){return new o.Convolver({impulse:e,dryLevel:0,wetLevel:1})}}}),o.Chorus=function(t){this.input=e.context.createGainNode(),this.attenuator=this.activateNode=e.context.createGainNode(),this.splitter=e.context.createChannelSplitter(2),this.delayL=e.context.createDelayNode(),this.delayR=e.context.createDelayNode(),this.feedbackGainNodeLR=e.context.createGainNode(),this.feedbackGainNodeRL=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.output=e.context.createGainNode(),this.lfoL=new o.LFO({target:this.delayL.delayTime,callback:f}),this.lfoR=new o.LFO({target:this.delayR.delayTime,callback:f}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.chorus,this.feedback=t.feedback,this.rate=t.rate,this.delay=t.delay,this.depth=t.depth,this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0)},o.Chorus.prototype=Object.create(l,{name:{value:"Chorus"},delay:{enumerable:!0,get:function(){return this._delay},set:function(e){this._delay=2e-4*Math.pow(10,2*e),this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(e){this._depth=e,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(e){this._feedback=e,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL._frequency=this._rate,this.lfoR._frequency=this._rate}}}),o.Compressor=function(t){this.input=e.context.createGainNode(),this.compNode=this.activateNode=e.context.createDynamicsCompressor(),this.makeupNode=e.context.createGainNode(),this.output=e.context.createGainNode(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.compressor,this.automakeup=t.automakeup,this.makeupGain=t.makeupGain,this.threshold=t.threshold,this.release=t.release,this.attack=t.attack,this.ratio=t.ratio,this.knee=t.knee},o.Compressor.prototype=Object.create(l,{name:{value:"Compressor"},computeMakeup:{value:function(){var e=4,t=this.compNode;return-(t.threshold.value-t.threshold.value/t.ratio.value)/e}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(e){this._automakeup=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(e){this.compNode.threshold.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(e){this.compNode.ratio.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(e){this.compNode.knee.value=e,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(e){this.compNode.attack.value=e/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(e){this.compNode.release=e/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(e){var n=e;this.makeupNode.gain.value=t.dbToWAVolume(n)}}}),o.Convolver=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.convolver=e.context.createConvolver(),this.dry=e.context.createGainNode(),this.filterLow=e.context.createBiquadFilter(),this.filterHigh=e.context.createBiquadFilter(),this.wet=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.convolver,this.dryLevel=t.dryLevel,this.wetLevel=t.wetLevel,this.highCut=t.highCut,this.buffer=t.impulse,this.lowCut=t.lowCut,this.level=t.level,this.filterHigh.type=0,this.filterLow.type=1},o.Convolver.prototype=Object.create(l,{name:{value:"Convolver"},lowCut:{get:function(){return this.filterLow.frequency},set:function(e){this.filterLow.frequency.value=e}},highCut:{get:function(){return this.filterHigh.frequency},set:function(e){this.filterHigh.frequency.value=e}},level:{get:function(){return this.output.gain},set:function(e){this.output.gain.value=e}},dryLevel:{get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},wetLevel:{get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e,this.wet.gain=e}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(t){var n=this.convolver,r=new XMLHttpRequest;return t?(r.open("GET",t,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){4===r.readyState&&(300>r.status&&r.status>199||302===r.status)&&e.context.decodeAudioData(r.response,function(e){n.buffer=e},function(e){e&&console.error("AudioNodes.Convolver.setBuffer: Error decoding data"+e)})},r.send(null),void 0):(console.error("AudioNodes.Convolver.setBuffer: Missing impulse path!"),void 0)}}}),o.Delay=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.dry=e.context.createGainNode(),this.wet=e.context.createGainNode(),this.filter=e.context.createBiquadFilter(),this.delay=e.context.createDelayNode(),this.feedbackNode=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.delay,this.tempoSync=t.tempoSync,this.tempoSync&&(this.subdivision=t.subdivision),this.delayTime=t.delayTime,this.feedback=t.feedback,this.wetLevel=t.wetLevel,this.dryLevel=t.dryLevel,this.cutoff=t.cutoff,this.filter.type=1},o.Delay.prototype=Object.create(l,{name:{value:"Delay"},tempoListener:{value:function(e){this.tempo=e,this.delayTime=this.tempo}},tempoSync:{get:function(){return this._tempoSync},set:function(t){if(t&&"string"==typeof t){var n=e.getInstance("player:"+t);this.tempo=n?n.tempo:90,this._tempoSync=t,dmaf.addEventListener("tempo_"+this._tempoSync,this.tempoListener.bind(this))}else this._tempoSync=!1}},subdivision:{get:function(){return this._subdivision},set:function(e){this._subdivision=e}},tempo:{get:function(){return this._tempo},set:function(e){this._tempo=e}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(e){this.delay.delayTime.value=this._tempoSync?60*a[this.subdivision]/this.tempo:e/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(e){this.feedbackNode.gain.value=e}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(e){this.filter.frequency.value=e}}}),o.EnvelopeFollower=function(t){this.input=e.context.createGainNode(),this.jsNode=this.output=e.context.createJavaScriptNode(this.buffersize,1,1),this.input.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.envelopeFollower,this.attackTime=t.attackTime,this.releaseTime=t.releaseTime,this._envelope=0,this.target=t.target,this.callback=t.callback},o.EnvelopeFollower.prototype=Object.create(l,{name:{value:"EnvelopeFollower"},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(e){this._attackTime=e,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(e){this._releaseTime=e,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(e){"function"==typeof e?this._callback=e:console.error(this.name+": Callback must be a function! TypeError: ",e)}},target:{get:function(){return this._target},set:function(e){"object"==typeof e?this._target=e:console.error(this.name+": Callback must be an AudioParam interface! TypeError: ",e)}},activate:{value:function(t){this.activated=t,t?(this.jsNode.connect(e.context.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(e){return function(t){e.compute(t)}}},compute:{value:function(e){var t,n,r,i,s=e.inputBuffer.getChannelData(0).length,o=e.inputBuffer.numberOfChannels;if(n=r=0,o>1)for(i=0;s>i;++i)for(;o>n;++n)t=e.inputBuffer.getChannelData(n)[i],r+=t*t/o;else for(i=0;s>i;++i)t=e.inputBuffer.getChannelData(0)[i],r+=t*t;r=Math.sqrt(r),r>this._envelope?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*r):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*r),this._callback(this._target,this._envelope)}}}),o.Equalizer=function(){function t(t){this._defaults=e.Settings.descriptors.type.audioNode.equalizer,this.nbands=t.bands.length;for(var n=0,r=this._nbands;r>n;n++);this.input=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode=e.context.createGainNode()}return t}(),o.Equalizer.prototype=Object.create(l,{name:{value:"Equalizer"},propertySearch:{value:/:bypass|:type|:frequency|:gain|:q/i}}),o.LFO=function(){function t(t){this.output=e.context.createJavaScriptNode(256,1,1),this.activateNode=e.context.destination,this.defaults=e.Settings.descriptors.type.audioNode.lfo,this.type=t.type,this.frequency=t.frequency,this.offset=t.offset,this.oscillation=t.oscillation,this.phase=t.phase,this.target=t.target,this.output.onaudioprocess=this.callback(t.callback)}return t.prototype=Object.create(l,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},type:{enumerable:!0,get:function(){return this._type},set:function(e){this._type=e}},frequency:{get:function(){return this._frequency},set:function(e){this._frequency=e,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(e){this._offset=e}},oscillation:{get:function(){return this._oscillation},set:function(e){this._oscillation=e}},phase:{get:function(){return this._phase},set:function(e){this._phase=e}},target:{get:function(){return this._target},set:function(e){this._target=e}},activate:{value:function(t){this._activated=t,t?this.output.connect(e.context.destination):this.output.disconnect(e.context.destination)}},callback:{value:function(e){var t=this;return function(){t._phase+=t._phaseInc,t._phase>2*Math.PI&&(t._phase=0),e(t._target,t._offset+t._oscillation*Math.sin(t._phase))}}}}),t}(),o.Overdrive=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.inputDrive=e.context.createGainNode(),this.waveshaper=e.context.createWaveShaper(),this.outputDrive=e.context.createGainNode(),this.output=e.context.createGainNode(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.overdrive,this.ws_table=new Float32Array(this.k_nSamples),this.drive=t.drive,this.outputGain=t.outputGain,this.curveAmount=t.curveAmount,this.algorithm=t.algorithmIndex},o.Overdrive.prototype=Object.create(l,{name:{value:"Overdrive"},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(e){this._drive=e}},curveAmount:{get:function(){return this._curveAmount},set:function(e){this._curveAmount=e,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(e){var n=e;this._outputGain=t.dbToWAVolume(n)}},algorithm:{get:function(){return this._algorithmIndex},set:function(e){this._algorithmIndex=e,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(e,t,n){var r,i,s=2*e/(1-e);for(r=0;t>r;r++)i=2*r/t-1,n[r]=(1+s)*i/(1+s*Math.abs(i))},function(e,t,n){var i,s,o;for(i=0;t>i;i++)s=2*i/t-1,o=(.5*Math.pow(s+1.4,2)-1)*o>=0?5.8:1.2,n[i]=r(o)},function(e,t,n){var i,s,o,u=1-e;for(i=0;t>i;i++)s=2*i/t-1,o=0>s?-Math.pow(Math.abs(s),u+.04):Math.pow(s,u),n[i]=r(2*o)},function(e,t,n){var r,s,o,u,a=1-e>.99?.99:1-e;for(r=0;t>r;r++)s=2*r/t-1,u=Math.abs(s),a>u?o=u:u>a?o=a+(u-a)/(1+Math.pow((u-a)/(1-a),2)):u>1&&(o=u),n[r]=i(s)*o*(1/((a+1)/2))},function(e,t,n){var r,i;for(r=0;t>r;r++)i=2*r/t-1,n[r]=-0.08905>i?-3/4*(1-Math.pow(1-(Math.abs(i)-.032857),12)+1/3*(Math.abs(i)-.032847))+.01:i>=-0.08905&&.320018>i?-6.153*i*i+3.9375*i:.630035},function(e,t,n){var r,i,s=2+Math.round(14*e),o=Math.round(Math.pow(2,s-1));for(r=0;t>r;r++)i=2*r/t-1,n[r]=Math.round(i*o)/o}]}}),o.Panner=function(t){this.input=e.context.createGainNode(),this.splitter=e.context.createChannelSplitter(2),this.lGain=e.context.createGainNode(),this.rGain=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.output=e.context.createGainNode(),this.input.connect(this.splitter),this.splitter.connect(this.lGain,0),this.splitter.connect(this.rGain,1),this.lGain.connect(this.merger,0,0),this.rGain.connect(this.merger,0,1),this.merger.connect(this.output),this.pan=t.value},o.Panner.prototype=Object.create(l,{pan:{get:function(){return this._value},set:function(e){var t=(e+100)/200;this._value=e,this.lGain.gain.value=Math.cos(t*Math.PI/2),this.rGain.gain.value=Math.sin(t*Math.PI/2)}}}),o.PingPongDelay=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.dry=e.context.createGainNode(),this.splitter=e.context.createChannelSplitter(2),this.toMono=e.context.createGainNode(),this.wet=e.context.createGainNode(),this.feedbackNode=e.context.createGainNode(),this.delayL=new o.Delay(t),this.delayR=new o.Delay(t),this.merger=e.context.createChannelMerger(),this.output=e.context.createGainNode(),this.activateNode.connect(this.dry),this.activateNode.connect(this.splitter),this.splitter.connect(this.toMono,0,0),this.splitter.connect(this.toMono,1,0),this.toMono.connect(this.wet),this.wet.connect(this.delayL.delay),this.feedbackNode.connect(this.delayL.delay),this.delayL.delay.connect(this.delayR.delay),this.delayR.delay.connect(this.feedbackNode),this.delayL.delay.connect(this.merger,0,0),this.delayR.delay.connect(this.merger,0,1),this.dry.connect(this.output),this.merger.connect(this.output),this.delayL.feedback=0,this.delayR.feedback=0,this.delayL.wetLevel=1,this.delayR.wetLevel=1,this.delayL.dryLevel=0,this.delayR.dryLevel=0,this.defaults=e.Settings.descriptors.type.audioNode.pingPongDelay,this.cutoff=t.cutoff,this.tempoSync=t.tempoSync,this.tempoSync&&(this.subdivision=t.subdivision),this.delayTime=t.delayTime,this.feedback=t.feedback,this.wetLevel=t.wetLevel,this.dryLevel=t.dryLevel},o.PingPongDelay.prototype=Object.create(l,{name:{value:"PingPongDelay"},tempoSync:{get:function(){return this._tempoSync},set:function(t){var n=t?e.getInstance("player",t):null;this.tempo=n?n.tempo:120,this._tempoSync=t,this.delayL.tempoSync=this._tempoSync,this.delayR.tempoSync=this._tempoSync}},tempo:{get:function(){return this._tempo},set:function(e){this._tempo=e,this.delayL.tempo=e,this.delayR.tempo=e}},subdivision:{get:function(){return this._subdivision},set:function(e){this._subdivision=e,this.delayL.subdivision=this._subdivision,this.delayR.subdivision=this._subdivision}},delayTime:{enumerable:!0,get:function(){return this._delayTime},set:function(e){this._tempoSync?(this._delayTime=60*a[this.subdivision]/this.tempo,this.delayL.delayTime=this._delayTime,this.delayR.delayTime=this._delayTime):(this._delayTime=e/1e3,this.delayL.delayTime=e,this.delayR.delayTime=e)}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(e){this.wet.gain.value=e}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(e){this.dry.gain.value=e}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(e){this.feedbackNode.gain.value=e}},cutoff:{enumerable:!0,get:function(){return this.delayL.filter.frequency},set:function(e){this.delayL.filter.frequency.value=e,this.delayR.filter.frequency.value=e}}}),o.Phaser=function(t){this.input=e.context.createGainNode(),this.splitter=this.activateNode=e.context.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=e.context.createGainNode(),this.feedbackGainNodeR=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.filteredSignal=e.context.createGainNode(),this.output=e.context.createGainNode(),this.lfoL=new o.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new o.LFO({target:this.filtersR,callback:this.callback});for(var n=this.stage;n--;)this.filtersL[n]=e.context.createBiquadFilter(),this.filtersR[n]=e.context.createBiquadFilter(),this.filtersL[n].type=7,this.filtersR[n].type=7;this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.phaser,this.rate=t.rate,this.baseModulationFrequency=t.baseModulationFrequency,this.depth=t.depth,this.feedback=t.feedback,this.stereoPhase=t.stereoPhase,this.lfoL.activate(!0),this.lfoR.activate(!0)},o.Phaser.prototype=Object.create(l,{name:{value:"Phaser"},stage:{value:4},callback:{value:function(e,t){for(var n=0;4>n;n++)e[n].frequency.value=t}},depth:{enumerable:!0,get:function(){return this._depth},set:function(e){this._depth=e,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(e){this._baseModulationFrequency=e,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency}},feedback:{get:function(){return this._feedback},set:function(e){this._feedback=e,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(e){this._stereoPhase=e;var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=s(t,2*Math.PI),this.lfoR._phase=t}}}),o.Tremolo=function(t){this.input=e.context.createGainNode(),this.splitter=this.activateNode=e.context.createChannelSplitter(2),this.amplitudeL=e.context.createGainNode(),this.amplitudeR=e.context.createGainNode(),this.merger=e.context.createChannelMerger(2),this.output=e.context.createGainNode(),this.lfoL=new o.LFO({target:this.amplitudeL.gain,callback:f}),this.lfoR=new o.LFO({target:this.amplitudeR.gain,callback:f}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.tremolo,this.rate=t.rate,this.intensity=t.intensity,this.stereoPhase=t.stereoPhase,this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0)},o.Tremolo.prototype=Object.create(l,{name:{value:"Tremolo"},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(e){this._intensity=e,this.lfoL.offset=this._intensity/2,this.lfoR.offset=this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(e){this._rate=e,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},steroPhase:{enumerable:!0,get:function(){return this._rate},set:function(e){this._stereoPhase=e;var t=this.lfoL._phase+this._stereoPhase*Math.PI/180;t=s(t,2*Math.PI),this.lfoR.phase=t}}}),o.WahWah=function(t){this.input=e.context.createGainNode(),this.activateNode=e.context.createGainNode(),this.envelopeFollower=new o.EnvelopeFollower({target:this,callback:function(e,t){e.sweep=t}}),this.filterBp=e.context.createBiquadFilter(),this.filterPeaking=e.context.createBiquadFilter(),this.output=e.context.createGainNode(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.defaults=e.Settings.descriptors.type.audioNode.wahWah,this.init(),this.automode=t.enableAutoMode,this.resonance=t.resonance,this.sensitivity=t.sensitivity,this.baseFrequency=t.baseModulationFrequency,this.excursionOctaves=t.excursionOctaves,this.sweep=t.sweep,this.envelopeFollower.activate(!0)},o.WahWah.prototype=Object.create(l,{name:{value:"WahWah"},activateCallback:{value:function(e){this.automode=e}},automode:{get:function(){return this._automode},set:function(e){this._automode=e,e?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(e){this._sweep=Math.pow(e>1?1:0>e?0:e,this._sensitivity),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=50*Math.pow(10,2*e),this._excursionFrequency=Math.min(this.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(e){this._excursionOctaves=e,this._excursionFrequency=Math.min(this.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(e){this._sensitivity=e,this._sensitivity=Math.pow(10,this._sensitivity)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(e){this._resonance=e,this.filterPeaking.Q=this._resonance}},init:{value:function(){var t,n,r=Object.keys(this.defaults);for(this.output.gain.value=5,this.filterPeaking.type=5,this.filterBp.type=2,this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1,this.sampleRate=e.context.sampleRate,t=0,n=r.length;n>t;t++)this[r[t]]=this.defaults[r[t]].value}}}),o}),dmaf("Action",["DMAF","Utils"],function(e,t){function n(e){this.actionProperties=e.actionProperties,this.triggers=e.triggers,this.delay=e.delay||0,this.type=e.type,this.id=e.id,this.multi="multi"===this.actionProperties.instanceId}return n.prototype={execute:function(n,r,i){var s,o,u;o=this.multi?n:this.actionProperties.instanceId,s=e.getInstance(this.type,o||"no_instance_id"),s?s._dynamicValues&&s.setDynamicValues():(u=t.clone(this.actionProperties),u.instanceId=o,u.type=this.type,u.id=this.id,s=e[this.type][this.id].createInstance(u)),s?s.onAction(n,r,i,this.actionProperties):console.log(this)}},n}),dmaf("Instance",[],function(){var e,t,n=/\:/;return dmaf.hasContext&&(t=window.webkitAudioContext||window.AudioContext,e=Object.getPrototypeOf((new t).createGainNode().gain.constructor.prototype)),{setInitProperties:function(e){for(var t,n=Object.keys(e),r=0,i=n.length;i>r;r++)t=n[r],this[t]=e[t];return this.setDynamicValues(),this},init:function(){return this},onAction:function(){return this},returnChildInstance:function(e){var t,r,s,o,u;if(n.test(e)&&(t=e.split(n),t.length&&t.length>1))for(u=this,s=0,o=t.length;o>s;s++){if(r=t[s],u=u[r],"object"!=typeof u)return{instance:this,ref:e};if(InstancePrototype.isPrototypeOf(u))return t=t.slice(s+1).join(":"),u.returnChildInstance(t)}return{instance:this,ref:e}},setProperty:function(t,r,s,o){var u,a=this.returnChildInstance(t);return a.instance!==this?a.instance.setProperty(a.ref,r,s,o):n.test(t)?(dmaf.log&&console.log("DMAF Does not support colon syntax for properties within arrays."),void 0):void 0===this[t]?(dmaf.log&&console.log(t,"is not a valid property for instance type",this.id),void 0):(r=this.verify(t,r),"volume"===t&&(r=Math.max(0,Math.floor(100*Math.pow(2,r/6))/100)),e.isPrototypeOf(this[t])?(o=o?o/1e3:0,s=s=s?s/1e3:0,u=s?"linearRampToValueAtTime":"setValueAtTime",this[t].cancelScheduledValues(o),this[t].setValueAtTime(this[t].value,o),this[t][u](r,s+o)):this[t]=r,void 0)},setDynamicValues:function(){var e,t,n,r=this._dynamicValues;if(r){for(var i=0,s=r.length;s>i;i++)t=r[i].string||"string_not_defined",e=r[i].key,n=DMAF.getInstanceProperty(t),this[e]=this.verify(e,n);return this}},verify:function(e,t,n){var r,i;switch(r=n?n:this.defaults[e],i=!!r,i=void 0===t,r.type){case"int":i=parseFloat(t)!==parseInt(t,10),t=parseInt(t,10),i=isNaN(t),i=!isFinite(t),i="number"!=typeof t,r.min>t&&(t=r.min),t>r.max&&(t=r.max);break;case"float":isNaN(parseFloat(t))&&(i=!0),isFinite(t)||(i=!0),"number"!=typeof t&&(i=!0),t=parseFloat(t),r.min>t&&(t=r.min),t>r.max&&(t=r.max);break;case"string":i="string"!=typeof t;break;case"list":i=!(t instanceof Array);break;case"enum":i=-1===r.value.indexOf(t);break;case"array":dmaf.log&&console.log("Array type found in verify",e,t,n);break;case"boolean":i="boolean"!=typeof t}return i?(dmaf.log&&console.log("DMAF Verification error",e,t,this),r["default"]):t}}}),dmaf("context",[],function(){function e(){return(new Date).getTime()/1e3}function t(){return context.currentTime=e(),setTimeout(t,40),context.currentTime}function n(){var e=r.createBufferSource();e.buffer=r.createBuffer(1,100,44100),e.noteOn(0),document.removeEventListener(i,n,!1)}var r;if(dmaf.hasContext){var i="createTouch"in document?"touchstart":"mousedown",s=window.webkitAudioContext||window.AudioContext||null;return document.addEventListener(i,n,!1),r=new s}return Object.create?Object.create(null,{currentTime:{get:e}}):{currentTime:t()}}),dmaf("DMAF",["InstanceManager","Instance","context"],function(e,t,n){function r(e){return function(t){var n,r;return f.test(t)?(n=t.split(f),n.length>2&&(r=n.slice(2),n.length=2,n.push(r))):n=arguments,n[0]?l[n[0]]?e.apply(l,n):(dmaf.log&&console.log("Invalid type!",n[0]),null):(dmaf.log&&console.log("Missing arguments!"),null)}}function i(t,n,r,i){this[t]=this[t]||Object.create(null),this[t].ids=this[t].ids||[],this[t].ids.push(n),r.prototype.defaults=this.Settings.descriptors.action[t][n]||{},this[t][n]=new e(r,i)}function s(e,t){for(var n,r,i=this[e].ids,s=0,o=i.length;o>s;s++)if(r=i[s],n=this[e][r].getInstance(t))return n;return null}function o(e,t,n){var r=this.getInstance(e,t);if(!r)return dmaf.log&&console.log("Missing instance",e,t),null;for(var i=0,s=n.length;s>i&&void 0!==r&&("object"==typeof r||"function"==typeof r);i++)r=r[n[i]];return i!==s?(dmaf.log&&console.log("Could not find property:",n.join(",")),null):r}function u(e){this[e.type]&&this[e.type][e.id]?this[e.type][e.id].addInstance(e):dmaf.log&&console.log(e.type,e.id,"was not registered with dmaf.")}function a(e,t){var n=this.getInstance(e,t);return n?this[n.type][n.id].removeInstance(t):(dmaf.log&&console.log("DMAF.remove: Could not find instance",e,t),!1)}var f=/[:]/,l={registeredObjects:{}};return l.getInstanceProperty=r(o),l.getInstance=r(s),l.registerInstance=i,l.removeInstance=a,l.addInstance=u,l.context=n,l}),dmaf("init",["DMAF","Utils","parser","ActionManager"],function(e,t,n,r){var i=e.Settings;if(dmaf.isBrowser){dmaf.hasContext||dmaf.failure(),dmaf.dev?(e.Settings.descriptors=n.parseDescriptors(e.Settings.descriptorsXML),e.Settings.actions=n.parseActions(e.Settings.configXML),window.DMAF=e,dmaf.log=!0):(e.require("settings"),"string"==typeof i.assetsPath&&(e.Settings.assetsPath=i.assetsPath));for(var s=Object.keys(e.registeredModules),o=0;s.length>o;o++)"init"!==s[o]&&"settings"!==s[o]&&e.require(s[o]);r.populate()}else dmaf.parser=n}),dmaf("public",["DMAF","ActionManager"],function(e,t){function n(n,r,i){dmaf.log&&console.log("dmaf.tell:",n),i||(i=1e3*e.context.currentTime),t.onEvent(n,i,r)}function r(e){var t=h,n=[],r=f.call(arguments,1);c=l=!1,t=h[e],t||(t=n);for(var i=0;t.length>i&&(n.push(t[i].apply(t[i].context,r)),l&&(i--,l=!1),!c);i++);return n.length?n:null}function i(e,t,n){for(var r=h[e]||(h[e]=[]),i=0,s=r.length;s>i;i++)if(r[i]===t)return t;t.context=n&&"object"==typeof n?n:dmaf,r.push(t)}function s(e,t){var n,r=h[e];if(!r||!r.length)return!1;for(n=r.length;n--;)if(r[n]==t){r.splice(n,1),l=!0;break}}function o(e,t,n){t.context=n&&"object"==typeof n?n:dmaf;var r=function(){var i=t.apply(n,arguments);return dmaf.removeEventListener(e,r),i};dmaf.addEventListener(e,r,n)}function u(n,r){return"string"!=typeof n?(dmaf.log&&console.log("DMAF: You must provide a valid id for the object you wish to register."),2):n?r&&r instanceof Object?(r.instanceId||(r.instanceId=n),e.registeredObjects[n]=r,t.onEvent(n+".CREATE"),void 0):(dmaf.log&&console.log("DMAF: You've tried to register an object not of type 'object'"),3):(dmaf.log&&console.log("DMAF: You must provide a valid id for the object you wish to register."),1)}function a(n){var r=e.registeredObjects[n],i=!1;return r&&(i=delete e.registeredObjects[n]),r=e.getInstance("customCode:"+n),r&&(i=e.removeInstance("customCode:"+n)),r=e.getInstance("mediaElement:"+n),r&&(i=e.removeInstance("mediaElement:"+n)),i&&t.onEvent(n+".REMOVE"),!1}var f=Array.prototype.slice,l=!1,c=!1,h={};e.dispatch=r,e.resolveListeners=function(){dmaf.once.resolve(o),dmaf.addEventListener.resolve(i),dmaf.removeEventListener.resolve(s),dmaf.stop.resolve(c),dmaf.unregisterObject.resolve(a)},e.resolveInput=function(){dmaf.tell.resolve?dmaf.tell.resolve(n):dmaf.tell=n,dmaf.registerObject.resolve(u)}}),dmaf("assetController",["DMAF","Utils","ActionManager","Instance","Assets","Parse"],function(e,t,n,r,i,s){function o(e){return!!m.canPlayType&&!!m.canPlayType(g[e]).replace(/no/,"")}function u(){}function a(){}function f(){}function l(){}function c(e){return e.name}var h,p="assetController",d={loadSampleMap:"xml/",loadMIDI:"midi/",loadSound:"audio/",loadCustomCode:"js/"},v=["ogg","aac","mp3","wav"],m=dmaf.isBrowser?document.createElement("audio"):{},g={wav:'audio/wav; codecs="1"',mp3:"audio/mpeg;",aac:'audio/mp4; codecs="mp4a.40.2"',ogg:'audio/ogg; codecs="vorbis"'},y=Object.create(r,{init:{value:function(){this.loadCount=0}},onload:{value:function(){this.returnEvent&&e.dispatch(this.returnEvent),e.removeInstance(this.type,this.instanceId)}},onstep:{value:function(){var t=100-Math.floor(100*(--i.loadsInProgress/i.loadTotals[this.task]));t!==i.loadPercents[this.task]&&(e.dispatch("progress_event",t,this.fileNames[this.loadCount]+this.format),i.loadPercents[this.task]=t),++this.loadCount===this.fileNames.length&&this.onload()}},onAction:{value:function(t){if(!this.inProgress){var n=e.Settings.assetsPath+d[this.id];i.listenForLoads(t),this.task=t,this.fileNames=this.files.map(c),i.loadsInProgress+=this.fileNames.length,this.inProgress=!0;for(var r=0,s=this.fileNames.length;s>r;r++)this.loadFile(n+this.fileNames[r]+this.format,this.fileNames[r],r)}}}});if(m.canPlayType!==void 0)for(var b=0,w=v.length;w>b;b++)if(o(v[b])){h="."+v[b];break}return void 0===h?dmaf.failure():(u.prototype=Object.create(y,{format:{value:".js"},loadFile:{value:function(t){var n=this,r=document.createElement("script");r.type="text/javascript",r.src=t,r.addEventListener("load",function(){e.dispatch("load_custom",e),n.onstep(),void 0!==r.remove&&r.remove()}),document.body.appendChild(r)}}}),e.registerInstance(p,"loadCustomCode",u),a.prototype=Object.create(y,{format:{value:".xml"},loadFile:{value:function(e){function n(e){s("samplemap",e)}var r={chain:[this.onstep],context:this,responseXML:!0,fail:function(){dmaf.log&&console.log("Problem parsing samplemap file"),this.onstep()}};t.ajax(e,n,r)}}}),e.registerInstance(p,"loadSampleMap",a),f.prototype=Object.create(y,{format:{value:".mid"},loadFile:{value:function(e,n,r){function i(e){s("midi",e,this.files[r].type,n),this.onstep()}var o={override:"text/plain; charset=x-user-defined",expectType:"string",context:this,fail:function(){dmaf.log&&console.log("Problem parsing midi file",e),this.onstep()}.bind(this)};t.ajax(e,i,o)}}}),e.registerInstance(p,"loadMIDI",f),l.prototype=Object.create(y,{loadFile:{value:function(n,r){function s(t){l>0&&dmaf.log&&console.log("Retry success",r),e.context.decodeAudioData(t,a,f)}function o(){3>++l?(dmaf.log&&console.log("Could not load audio file",r,"trying again."),t.ajax(n,s,u,"buffer")):(dmaf.log&&console.log("Could not load audio file",r),this.onstep())}var u={responseType:"arraybuffer",fail:o.bind(this)},a=function(e){i.buffer[r]=e,this.onstep()}.bind(this),f=function(e){dmaf.log&&console.log("Could not decode file",r,e),this.onstep()}.bind(this),l=0;t.ajax(n,s,u,"buffer")}},format:{value:h}}),e.registerInstance(p,"loadSound",l),void 0)}),dmaf("audioRouter",["DMAF","Utils","InstanceManager","Instance","AudioNodes"],function(e,t,n,r,i){function s(){this.input=e.context.createGainNode(),this.output=e.context.createGainNode()}var o="audioRouter";s.prototype=Object.create(r,{init:{value:function(t){var n=this.input;if(this.effects=i.createRecursive(this.input,t.audioNodes),this.effects.length>0&&(n=this.effects[this.effects.length-1]),n.connect(this.output),"master"===this.outputBus)this.output.connect(e.context.destination);else{var r=e.getInstance(o,this.outputBus);this.output.connect(r?r.input:e.context.destination)}}},volume:{get:function(){return this.output.gain},set:function(e){this.output.gain.value=t.dbToWAVolume(e)}},getAutomatableProperties:{value:function(e){return"fx"==e.substring(0,2)?this.effects[parseInt(e.substring(2),10)]:void 0}},setAutomatableProperty:{value:function(t,n,r,i){var s=r>0?"linearRampToValueAtTime":"setValueAtAtTime";switch(t){case"volume":n=parseFloat(n),t="gain";break;case"pan":break;default:return}this.output[t].cancelScheduledValues(e.context.currentTime),this.output[t].setValueAtTime(this.output[t].value,e.context.currentTime),this.output[t][s](n,(i+r)/1e3)}},onAction:{value:function(){}}}),e.registerInstance(o,"audioBus",s)}),dmaf("beatPatternPlayer",["DMAF","TimeManager","InstanceManager","Instance","beatPattern","beatPosition","beatPatternInstance","ActionManager","Assets"],function(e,t,n,r,i,s,o,u,a){function f(){this.state=this.STOPPED,this.pendingPatterns=[],this.activePatterns=[],this.pendingEvents=[],this.tempo=120,this.songPosition=new s(0,16,16),this.currentPattern=new o(this,{beatPattern:new i("master",1),channel:"master",addAtSongPosition:new s(1,1,16),patternStartPosition:1,clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:16,clearPosition:new s(1,1,16)})}function l(){var t,n,r=(new Date).getTime(),i=1e3*e.context.currentTime;return c&&(l.lastDifference=t,c=!1),t=r-i,n=t-l.lastDifference,Math.abs(n)>5?(dmaf.log&&console.log("DMAF: Adjusting next beat Time. Difference was "+n+"ms"),l.lastDifference=t,n):0}var c=!0;f.prototype=Object.create(r,{STOPPED:{value:0},RUNNING:{value:1},tempo:{get:function(){return this._tempo},set:function(t){this._tempo=t,this.beatLength=250*(60/t),e.dispatch("tempo_"+this.instanceId,this._tempo)}},onAction:{value:function(n,r,i,s){if(s.flowItems)for(var o,u,a=s.flowItems,f=0,l=a.length;l>f;f++){if(o=Object.create(a[f]),"trigger"===o.patternId&&(o.patternId=n),o._dynamicValues)for(var c=0,h=o._dynamicValues.length;h>c;c++)u=o._dynamicValues[c],o[u.key]=e.getInstanceProperty(u.string);switch(o.id){case"start":if(this.state===this.RUNNING)break;if(o.delay){var p=o.delay?r+o.delay:r;t.checkFunctionTime(p,this.start,[],this,o,p)}else this.start(o,r);break;case"add":this.addPattern(o);break;case"stop":if(this.state===this.STOPPED)break;this.stop(o);break;case"beatEvent":this.beatEvent(o)}}}},addPattern:{value:function(e){if(this.state===this.RUNNING){e.beatPattern=a.getAsset("beatPattern",e.patternId),e.addAtSongPosition=this.getSongPosition(e.songPosition),e.startPatternAtBeat=this.getStartAtBeat(e.patternPosition),e.clearPosition=this.getSongPosition(e.clearPosition);var t=new o(this,e);if(e.clearPending)if("main"===e.channel)this.pendingPatterns.length=0;else for(var n=this.pendingPatterns.length;n--;)this.pendingPatterns[n].channel===e.channel&&this.pendingPatterns.splice(n,1);t.ERROR||this.pendingPatterns.push(t)}}},checkBeat:{value:function(){for(var t=1e3*e.context.currentTime;t-this.nextBeatTime-e.preListen>this.beatLength;)this.skipBeat(this.nextBeatTime);for(;t>=this.nextBeatTime-e.preListen;)this.updateBeat(this.nextBeatTime)}},skipBeat:{value:function(e){this.songPosition.gotoNextBeat(),this.nextBeatTime=e+this.beatLength;for(var t=0,n=this.activePatterns.length;n>t;t++)this.activePatterns[t].gotoNextBeat();this.updateActivePatterns()}},updateBeat:{value:function(e){this.nextBeatTime=e+this.beatLength-l(),this.songPosition.gotoNextBeat();for(var t=0,n=this.activePatterns.length;n>t;t++)this.activePatterns[t].gotoNextBeat();for(this.updateActivePatterns(),t=0,n=this.activePatterns.length;n>t;t++)this.activePatterns[t].executeEvents(e,this.beatLength)}},updateActivePatterns:{value:function(){for(var e,t,n,r,i,s=0;this.pendingPatterns.length>s;s++)if(n=this.pendingPatterns[s].addAtSongPosition,n.bar===this.songPosition.bar&&n.beat===this.songPosition.beat){if(e=this.pendingPatterns[s],this.pendingPatterns.splice(s--,1),e.replaceActive)for(r=0,i=this.activePatterns.length;i>r;r++)("main"===e.channel||e.channel===this.activePatterns[r].channel)&&(this.activePatterns[r].removeAtSongPosition=e.clearPosition);e.setAsCurrent&&(this.currentPattern=e),this.activePatterns.push(e)}for(s=0;this.activePatterns.length>s;s++)t=this.activePatterns[s].removeAtSongPosition,t.bar===this.songPosition.bar&&t.beat===this.songPosition.beat?this.activePatterns.splice(s--,1):t.bar<this.songPosition.bar&&this.activePatterns.splice(s--,1)}},start:{value:function(e,n){this.tempo=e.tempo||120,this.nextBeatTime=n,this.beatsPerBar=e.beatsPerBar,this.state=this.RUNNING,t.addFrameListener("checkBeat",this.checkBeat,this)}},stop:{value:function(n){var r=this.getSongPosition(n.songPosition).getInBeats(),i=this.songPosition.getInBeats(),s=(r-i)*this.beatLength;s+=1e3*e.context.currentTime,s=Math.max(1e3*e.context.currentTime,s),t.checkFunctionTime(s,this.proceedStop,[],this,n)}},proceedStop:{value:function(){this.state=this.STOPPED,this.pendingPatterns.length=0,this.activePatterns.length=0,t.removeFrameListener("checkBeat"),this.songPosition=new s(0,this.beatsPerBar,this.beatsPerBar),this.currentPattern=new o(this,{beatPattern:new i("MASTER",1),channel:"MASTER",addAtSongPosition:new s(1,1,16),patternStartPosition:1,clearPending:!0,replaceActive:!0,setAsCurrent:!0,loop:!0,loopLength:16,clearPosition:new s(1,1,16)})}},beatEvent:{value:function(n){var r=this.getSongPosition(n.songPosition).getInBeats(),i=this.songPosition.getInBeats(),s=(r-i)*this.beatLength;switch(s+=1e3*e.context.currentTime,n.output){case"onEvent":t.checkFunctionTime(s,u.onEvent,this.pendingEvents,u,n.returnEvent);break;case"dispatch":t.checkFunctionTime(s,e.dispatch,this.pendingEvents,e,n.returnEvent)}}},getSongPosition:{value:function(e){var t,n=e,r=0,i=0,o=new s(this.songPosition.bar,this.songPosition.beat,this.beatsPerBar);switch(/\+/.test(n)&&(t=n.split("+"),n=t[0],t=t[1].split("."),i=parseInt(t[0],10)||0,r=parseInt(t[1],10)||0),n){case"NEXT_BEAT":o.addOffset({bar:0,beat:1});break;case"NEXT_BAR":o.beat=1,o.bar++;break;case"ASAP":return o;default:dmaf.log&&console.log("BeatPatternPlayer getSongPosition: Unrecognized songPosition ",n)}return o.bar+=i,o.beat+=r,o}},getStartAtBeat:{value:function(e){var t,n=e,r=0,i=0,s=this.currentPattern&&this.currentPattern.currentBeat||1;if(!n)return 1;switch(/\+/.test(n)&&(t=n.split("+"),n=t[0],t=t[1].split("."),i=parseInt(t[0],10)||0,r=parseInt(t[1],10)||0),n){case"FIRST_BEAT":s=1;break;case"SYNC":s++;break;default:dmaf.log&&console.log("BeatPatternPlayer: Unrecognized patternPosition "+n)}return s+=i*(this.currentPattern&&this.currentPattern.beatsPerBar||16),s+=r}}}),e.registerInstance("player","beatPatternPlayer",f)}),dmaf("customCode",["DMAF","InstanceManager","Instance"],function(e,t,n){function r(){}function i(){}r.prototype=Object.create(n),e.registerInstance("customCode","customCode",r),e.customCode.customCode.createInstance=function(t){if(e.customCode[t.instanceId]){var n=e.customCode[t.instanceId].createInstance(t);return n}dmaf.log&&console.log(t.instanceId,"was not registered with DMAF")},i.prototype=Object.create(n,{onAction:{value:function(){var t=e.registeredObjects[this.instanceId];t&&(this.obj=t)}}}),e.registerInstance("customCode","userObject",i)}),dmaf("eventProcessor",["DMAF","ActionManager","TimeManager","InstanceManager","Instance"],function(e,t,n,r,i){function s(){}function o(){}var u="eventProcessor",a=[];s.prototype=Object.create(i,{init:{value:function(){this.lastActionTime=this.reTrig}},onAction:{value:function(r,i,s){var o;if(!(i-this.lastActionTime<this.reTrig)){for(var u=0,f=this.eventMaps.length;f>u;u++)if(-1!==this.eventMaps[u]["in"].indexOf(r)){if(r===this.eventMaps[u].out){dmaf.log&&console.log("DMAF.EventMapper: ",r," is the same in event as output. Ignoring...");continue}o=this.eventMaps[u].delay||0,n.checkFunctionTime(i+o+e.preListen,t.onEvent,a,t,this.eventMaps[u].out,i+o+e.preListen,s)}else"multi"===this.eventMaps[u]["in"][0]&&(o=this.eventMaps[u].delay||0,n.checkFunctionTime(i+o+e.preListen,t.onEvent,a,t,this.eventMaps[u].out,i+o+e.preListen,s));this.lastActionTime=i}}}}),e.registerInstance(u,"eventMapper",s),o.prototype=Object.create(r,{init:{value:function(){for(var e=0,t=this.eventMaps.length;t>e;e++)this.eventMaps[e]["in"]=parseInt(this.eventMaps[e]["in"],10),isNaN(this.eventMaps[e]["in"])&&dmaf.log&&console.log("In value for MidiNoteMapper is NaN!")}},onAction:{value:function(e,n,r){if(r&&r.midiNote)for(var i=0,s=this.eventMaps.length;s>i;i++)this.eventMaps[i]["in"]===r.midiNote&&t.onEvent(this.eventMaps[i].out,n,r)}}}),e.registerInstance(u,"midiNoteMapper",o)}),dmaf("mediaElement",["DMAF","ActionManager","TimeManager","InstanceManager","Instance"],function(e,t,n,r,i){function s(){}function o(){}var u="mediaElement";s.prototype=Object.create(i,{currentTime:{get:function(){return this.element?this.element.currentTime:void 0},set:function(){dmaf.log&&console.log("MediaElement currentTime is read-only")}},onAction:{value:function(){if(this.element)return null;var t=this.instanceId,r=e.pendingObjects[t];r?r instanceof HTMLElement&&("VIDEO"===r.tagName||"AUDIO"===r.tagName?(this.element=r,this.playing=!1,this.lastPlayTime=r.currentTime,n.addFrameListener(this.type+":"+this.instanceId,this.poll,this)):dmaf.log&&console.log("DMAF does not support registering HTML elements other than <video> and <audio>")):dmaf.log&&console.log("DMAF Could not locate mediaElement with id",this.instanceId)}},poll:{value:function(){this.lastPlayTime===this.element.currentTime?this.playing&&(t.onEvent(this.instanceId+".STOP",1e3*e.context.currentTime),this.playing=!1):this.lastPlayTime-this.element.currentTime>.25?t.onEvent(this.instanceId+".START",1e3*(e.context.currentTime-this.currentTime)):this.element.currentTime-this.lastPlayTime>.25?t.onEvent(this.instanceId+".START",1e3*(e.context.currentTime-this.currentTime)):this.playing||(t.onEvent(this.instanceId+".START",1e3*(e.context.currentTime-this.currentTime)),this.playing=!0),this.lastPlayTime=this.element.currentTime}}}),e.registerInstance(u,"mediaElement",s),e.mediaElement.mediaElement.removeInstance=function(t){var n=e.getInstance("mediaElement:"+t);return n&&e.Clock.removeFrameListener(u+":"+t),delete this.activeInstances[t]},o.prototype=Object.create(i,{onAction:{value:function(e,t){var n,r=/CREATE|REMOVE/.exec(e);r.length&&(r=r[0].toLowerCase(),n=e.split(".")[0],this[r](t,n))}},create:{value:function(t,r){var i=e.mediaElement.mediaElement.createInstance({instanceId:r,type:u,id:"mediaElement"});n.checkFunctionTime(t,i.onAction,[],i)}},remove:{value:function(t,n){return e.mediaElement.mediaElement.removeInstance(n)}}}),e.registerInstance("control","mediaController",o,!0)}),dmaf("midiProcessor",["DMAF","ActionManager","Utils","InstanceManager","Instance"],function(e,t,n,r,i){function s(){}function o(){}var u="midiProcessor",a={OFF:[0,0,0,0,0,0,0,0,0,0,0,0],major:[0,-1,0,-1,0,0,-1,0,-1,0,-1,0],harmonicMinor:[0,1,0,0,-1,0,1,0,0,-1,1,0],naturalMinor:[0,-1,0,0,-1,0,-1,0,0,-1,0,-1],majorPentatonic:[0,1,0,1,0,-1,1,0,1,0,-1,1],minorPentatonic:[0,-1,1,0,-1,0,1,0,-1,1,0,-1],dorian:[0,1,0,0,-1,0,1,0,1,0,0,-1],phrygian:[0,0,-1,0,-1,0,1,0,0,-1,0,-1],lydian:[0,1,0,1,0,1,0,0,1,0,1,0],mixolydian:[0,1,0,1,0,0,-1,0,-1,0,-1],locrian:[0,0,-1,0,-1,0,0,-1,0,-1,0,-1],doubleHarmonic:[0,0,-1,1,0,0,1,0,0,-1,1,0],halfDim:[0,1,0,0,-1,0,0,-1,0,-1,0,-1],pentatonic:[0,-1,-2,0,-1,0,-1,0,-1,-2,0,-1]},f={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11};s.prototype=Object.create(i,{updateValues:{value:["transpose","scale","root"]},scale:{get:function(){return this._scale},set:function(e){this._scale=a[e]}},root:{get:function(){return this._root},set:function(e){this._root=f[e]}},onAction:{value:function(e,t,n){return n?n.midiNote?(this.transpose&&(this.transpose=parseInt(this.transpose,10),n.midiNote+=this.transpose),this.scale&&this.quantizeToScale(n),void 0):(dmaf.log&&console.log("no midiNote for",e),void 0):(dmaf.log&&console.log("no eventProperties for",e),void 0)}},quantizeToScale:{value:function(e){var t;return e.midiNote&&(t=e.midiNote%12,t-=this._root,0>t&&(t=12+t),e.midiNote+=this.scale[t]),e}}}),e.registerInstance(u,"midiProcessor",s),o.prototype=Object.create(i,{init:{value:function(){this.lastActionTime=this.reTrig;for(var e=0,t=this.noteMaps.length;t>e;e++)this.noteMaps[e].midiNote=n.toMIDINote(this.noteMaps[e].note)}},onAction:{value:function(e,n){var r;if(!(n-this.lastActionTime<this.reTrig)){for(var i=0,s=this.noteMaps.length;s>i;i++)e===this.noteMaps[i].triggerIn&&(r={type:"noteOn",midiNote:this.noteMaps[i].midiNote,velocity:this.noteMaps[i].velocity,duration:this.noteMaps[i].duration},t.onEvent(this.noteMaps[i].triggerOut,n,r));this.lastActionTime=n}}}}),e.registerInstance(u,"makeNote",o)}),dmaf("parameterProcessor",["DMAF","TimeManager","InstanceManager","Instance"],function(e,t,n,r){function i(){this.timeoutContainer=[]}function s(){}var o="parameterProcessor";i.prototype=Object.create(r,{onAction:{value:function(e,n){this.targets.length&&("multi"===this.targets[0]&&(this.targets=[e.replace(this.multiSuffix,"")]),t.checkFunctionTime(this.actionTime,this.execute,this.timeoutContainer,this,n))}},execute:{value:function(t){for(var n,r=this.targets.slice(0);r.length;)n=e.getInstance(this.targetType,r.shift()),n&&(dmaf.log&&console.log("Transforming",this.targetParameter,"of",n.instanceId),n.setProperty(this.targetParameter,this.value,this.duration,t))}}}),e.registerInstance(o,"transform",i),s.prototype=Object.create(r,{onAction:{value:function(t,n){for(var r,i,s,o=0,u=this.targets.length;u>o;o++)r=this.targets[o],s=e.getInstance(r.targetType,r.targetId),s&&(i=r.min+(r.max-r.min)*this.value,s.setProperty(r.targetParameter,i,this.duration,n))}}}),e.registerInstance(o,"macro",s)}),dmaf("sound",["DMAF","Utils","TimeManager","ActionManager","InstanceManager","Instance","Iterator","Assets"],function(e,t,n,r,i,s,o,u){function a(){this.output=e.context.createGainNode()}function f(t){this.iterator=new o(t.soundFiles,t.generator),this.output=e.context.createGainNode()}function l(){}function c(t,n){e.context.currentTime>n&&(n=e.context.currentTime+this.delay);var r=t.replace(this.multiSuffix,""),i=e.getInstance("sound",r);i&&i.stop(n)}function h(t,n){var r;1e3*e.context.currentTime>n&&(n=1e3*e.context.currentTime+this.delay);for(var i=0,s=this.targets.length;s>i;i++)r=e.getInstance("sound",this.targets[i]),r&&r.stop(n)}var p="sound",d=0,v=Object.create(s,{init:{value:function(t){if(this.pendingPlays=[],this.pendingStops=[],this.pendingEvents=[],this.pendingSoftLoop=[],this.sounds=[],this.playing=!1,this.previousActionTime=0,t.bus&&"master"!==t.bus){var n=e.getInstance("audioRouter",t.bus);this.targetBus=n?n.input:e.context.destination}else this.targetBus=e.context.destination;this.output.connect(this.targetBus)}},checkFinished:{value:function(){this.sounds=this.sounds.filter(function(e){return 3!==e.playbackState})}},clearAll:{value:function(){for(var e=this.sounds,t=e.length;t--;)this.sounds[t].noteOff(0);this.sounds.length=0,this.playing=!1}},createSound:{value:function(){var t=e.context.createBufferSource(),n=u.getAsset("buffer",this.getSoundFile());return n?(t.id=d++,t.buffer=n,t.connect(this.output),-2===this.loop&&(t.loop=!0),t):(dmaf.log&&console.log("GenericPlay: Buffer is missing. Check soundFile property."),{buffer:{duration:-1},noteOn:function(){},noteGrainOn:function(){}})}},dispose:{value:function(e){for(var t=this.sounds.length;t--;)this.sounds[t].id===e&&this.sounds.splice(t,1);this.playing=!!this.sounds.length}},play:{value:function(e){this.checkFinished(),n.dropPendingArray(this.pendingStops),this.playing?(this.reTrig>-1&&(n.dropPendingArray(this.pendingPlays),n.dropPendingArray(this.pendingEvents)),0===this.reTrig||"RESYNC"===this.timingCorrection?(dmaf.log&&console.log("scheduling",this.instanceId,"for",e),n.checkFunctionTime(e,this.proceedPlay,this.pendingPlays,this,e)):this.reTrig>0&&e-this.previousActionTime>this.reTrig&&(this.previousActionTime=e,dmaf.log&&console.log("scheduling",this.instanceId,"for",e),n.checkFunctionTime(e,this.proceedPlay,this.pendingPlays,this,e))):(this.previousActionTime=e,dmaf.log&&console.log("scheduling",this.instanceId,"for",e),n.checkFunctionTime(e,this.proceedPlay,this.pendingPlays,this,e))}},proceedPlay:{value:function(t){dmaf.log&&console.log("playing",this.instanceId,"at",Math.floor(1e3*e.context.currentTime));var i=this.createSound(),s=Math.abs(t-1e3*e.context.currentTime),o=1e3*i.buffer.duration,u=o-s,a=t+(this.loop||o);switch(this.timingCorrection){case"PLAY":i.noteOn(t/1e3);break;case"SYNC":if(0>=u)return;i.noteGrainOn(Math.max(0,t/1e3),s/1e3,u/1e3);break;case"RESYNC":if(0>=u)return;this.clearAll(),i.noteGrainOn(Math.max(0,t/1e3),s/1e3,u/1e3)}n.dropPendingArray(this.pendingEvents),this.returnEvent&&n.checkFunctionTime(t+o+this.returnEventTime,r.onEvent,this.pendingEvents,r,this.returnEvent,t+o+this.returnEventTime),this.loop>-1&&(n.checkFunctionTime(a,this.proceedPlay,this.pendingSoftLoop,this,a),n.checkFunctionTime(a,this.dispose,[],this,i.id),i.noteOff(t/1e3+i.buffer.duration)),-2===this.loop||n.checkFunctionTime(t+o,this.dispose,[],this,i.id),this.playing=!0,this.sounds.push(i)}},stop:{value:function(t){dmaf.log&&console.log("scheduling stop",this.instanceId,"at",Math.floor(1e3*e.context.currentTime)),n.dropPendingArray(this.pendingPlays),n.dropPendingArray(this.pendingStops),n.checkFunctionTime(t,this.proceedStop,this.pendingStops,this)}},proceedStop:{value:function(){dmaf.log&&console.log("Stopping",this.instanceId,"at",Math.floor(1e3*e.context.currentTime)),this.sounds.length,n.dropPendingArray(this.pendingEvents),n.dropPendingArray(this.pendingSoftLoop),this.clearAll(),e.sound[this.id].removeInstance(this.instanceId)}},volume:{get:function(){return this.output.gain},set:function(e){this._volume=e,this.waVolume=t.dbToWAVolume(this._volume),this.output.gain.value=this.waVolume}},onAction:{value:function(e,t){"multi"===this.soundFile&&(this.soundFile=e),this.play(t)}}});a.prototype=Object.create(v,{getSoundFile:{value:function(){return this.soundFile}}}),e.registerInstance(p,"genericPlay",a),f.prototype=Object.create(v,{getSoundFile:{value:function(){return this.iterator.getNext()}}}),e.registerInstance(p,"stepPlay",f),l.prototype=Object.create(s,{init:{value:function(){this.onAction="multi"===this.targets[0]?c:h}}}),e.registerInstance(p,"soundStop",l,!0)}),dmaf("stateProcessor",["DMAF","InstanceManager","Instance"],function(e,t,n){function r(){this.value=void 0,this.previous=void 0}var i="stateProcessor",s="in";r.prototype=Object.create(n,{onAction:{value:function(t){var n,r,i,u,a;for(r=0,i=this.stateMaps.length;i>r;r++)for(u=0,a=this.stateMaps[r][s].length;a>u;u++)this.stateMaps[r][s][u]===t&&(n=this.stateMaps[r].state,this.stateMaps[r]._dynamicValues&&(n=e.getInstanceProperty(this.stateMaps[r]._dynamicValues[0].string)),r=i,u=a);if(!n)return dmaf.log&&console.log("StateProcesor: No state found for",t),!1;switch(this.update){case"always":this.previous=this.value,this.value=n;break;case"onChange":n!==this.value&&(this.previous=this.value,this.value=n)}}}}),e.registerInstance(i,"state",r)}),dmaf("synth",["DMAF","Utils","InstanceManager","TimeManager","Instance","Assets","AudioNodes"],function(e,t,n,r,i,s,o){function u(t){this.input=e.context.createGainNode(),this.output=e.context.createGainNode(),this.Note=c.call(this,t)}function a(t,n,r){if(t)this.input.connect(this.output),this.output.connect(t);else{var i=this.input;if(this.effects=o.createRecursive(i,n),this.effects.length>0&&(i=this.effects[this.effects.length-1]),i.connect(this.output),r&&"master"!==r){var s=e.getInstance("audioRouter",r);s?this.output.connect(s.input):this.output.connect(e.context.destination)}else this.output.connect(e.context.destination)}}function f(){for(var t,n,r=e.context.currentTime,i=this.samples.active,s=this.samples.sustained,o=Object.keys(i),u=o.length;u--;)for(n=o[u],t=i[n].length;t--;)r>i[n][t].disposeTime&&i[n].splice(t,1);for(u=s.length;u--;)r>s[u].disposeTime&&s.splice(u,1)}function l(t,n,r){var i=this._loop&&this._sustain,s=this._loop?1/0:1e3*t.bufferLength-t.ampRelease,o=this.ignoreNoteOff?s:r?r:s,u=n+(i?1/0:o);isFinite(u)&&t._noteOff(u),this.sustained||!r?(this.samples.sustained.push(t),this.samples.sustained.length>this.numberOfVoices&&this.samples.sustained[0]._noteOff(1e3*e.context.currentTime)):this.samples.active[t.midiNote].push(t)}function c(){function t(t){this.bufferSource=e.context.createBufferSource(),this.amp=e.context.createGainNode(),this.filter=this.filterOn&&e.context.createBiquadFilter(),this.bufferSource.connect(this.filter||this.amp),this.filter&&this.filter.connect(this.amp),this.amp.connect(this.output),this.parent=t.parent,this.midiNote=t.midiNote,this.bufferSource.gain.value=void 0!==t.sampleGain?v(parseInt(t.sampleGain,10)):1,this.bufferSource.playbackRate.value=p(this.midiNote)/p(d(t.baseNote)),this.bufferSource.buffer=s.getAsset("buffer",t.buffer),this.bufferLength=this.bufferSource.buffer.length/e.context.sampleRate,this.velocity=Math.pow(t.velocity/127,1.2),this.bufferSource.loop=this.parent.loop,this.filterOn&&(this.filter.Q.value=this.filterQ,this.filter.gain=this.filterGain)}return t.prototype=Object.create(this),t.prototype.output=this.input,t.prototype._noteOn=m.noteOn,t.prototype._noteOff=m.noteOff,t}var h="synth",p=t.MIDIToFrequency,d=t.toMIDINote,v=t.dbToWAVolume;u.prototype=Object.create(i,{init:{value:function(e){a.apply(this,[e.output,e.audioNodes,e.bus]),this._sustain=!1,this.samples={meta:Object.create(null),maps:Object.create(null),used:Object.create(null),active:Object.create(null),sustained:[]};for(var t,n=0,i=e.sampleMapGroups[0].sampleMaps.length;i>n;n++)t=e.sampleMapGroups[0].sampleMaps[n].name.toLowerCase(),t="multi"===t?this.instanceId.toLowerCase():t.toLowerCase(),this.samples.meta[t]=e.sampleMapGroups[0].sampleMaps[n];for(var o in this.samples.meta)this.samples.maps[o]=s.getAsset("sampleMap",o),this.samples.used[o]=Object.create(null);r.addFrameListener(this.instanceId,f,this)}},numberOfVoices:{value:16},volume:{get:function(){return this.output.gain.value},set:function(e){this.output.gain.value=t.dbToWAVolume(e)}},sustain:{get:function(){return this._sustain},set:function(t){if(t)this._sustain=!0;else{this._sustain=!1;for(var n=0,r=this.samples.sustained.length;r>n;n++)this.samples.sustained[n]._noteOff(1e3*e.context.currentTime)}}},filterSustain:{get:function(){return this._filterSustain},set:function(e){this._filterSustain=Math.pow(e,4)}},controller:{value:function(e,t){switch(t.controllerType){case 64:this.sustain=!!t.value;break;case 123:t.value&&this.stopAll();break;default:dmaf.log&&console.error("Unrecognized controller number for",this.instanceId,":",t.controllerType)}}},onAction:{value:function(e,t,n){n&&(this[n.type]?this[n.type](t,n):dmaf.log&&console.log("Sampler does not recognize message ",n))}},getRange:{value:function(e,t){var n,r,i,s,o=this.samples.meta,u=this.samples.maps,a=this.samples.used,f=0,l=[];for(r in o)if(t>=o[r].velocityLow&&o[r].velocityHigh>=t){n=u[r];for(i in n)s=n[i],e>=d(s.low)&&d(s.hi)>=e&&l.push(s)}return 1!==l.length&&(void 0!==a[r][e]&&(f=(a[r][e]+1)%l.length),a[r][e]=f),l[f]}},noteOn:{value:function(e,t){var n,r=this.samples.active,i=t.midiNote,o=t.velocity,u=t.duration||t.endTime,a=this.getRange(i,o);a&&a.sound&&s.getAsset("buffer",a.sound)&&(n=new this.Note({parent:this,sampleGain:a.vol,baseNote:a.root,buffer:a.sound,midiNote:i,velocity:o}),r[i]?r[i].length&&!this.ignoreNoteOff&&this.noteOff(e,t):r[i]=[],this.loop&&this.ignoreNoteOff&&(dmaf.log&&console.log("Sampler Configuration Error: You cannot use looped samples with ignoreNoteOff."),t.duration?this.ignoreNoteOff=!1:this.loop=!1),n._noteOn(e),l.apply(this,[n,e,u]))}},noteOff:{value:function(t,n){var r,i,s=this.samples.active,o=this.samples.sustained,u=n.midiNote;if(u&&!this.ignoreNoteOff){if(s[u])for(r=0,i=s[u].length;i>r;r++)s[u][r]._noteOff(t||1e3*e.context.currentTime);if(!this.sustain)for(r=0,i=o.length;i>r;r++)o[r].midiNote===u&&o[r]._noteOff(t||1e3*e.context.currentTime)}}},stopAll:{value:function(){var t,n=this.samples.active,r=this.samples.sustained;for(var i in n){for(t=n[i].length;t--;)n[i][t]._noteOff(1e3*e.context.currentTime);for(t=r.length;t--;)r[t]._noteOff(1e3*e.context.currentTime)}}}});var m={noteOn:function(e){var t=e+this.ampAttack,n=t+this.ampDecay,r=1-this.ampVelocityRatio+this.velocity*this.ampVelocityRatio,i=Math.pow(this.ampSustain*r,2);if(this.noteOnTime=e,this.ampPeakValue=r,this.ampSustainValue=i,this.amp.gain.setValueAtTime(0,e/1e3),this.amp.gain.linearRampToValueAtTime(r,t/1e3),this.amp.gain.linearRampToValueAtTime(i,n/1e3),this.filterOn){var s=e+this.filterAttack,o=s+this.filterDecay,u=1-this.filterVelocityRatio+this.velocity*this.filterVelocityRatio,a=this.filterADSRAmount*u,f=this.filterFrequency+a,l=this.filterFrequency+this.filterSustain*a;f=p(12*f+this.midiNote),l=p(12*l+this.midiNote),f=20>f?20:f>2e4?2e4:f,l=20>l?20:l>2e4?2e4:l,this.filterFrequency=p(12*this.filterFrequency+this.midiNote),this.filter.frequency.setValueAtTime(this.filterFrequency,e/1e3),this.filter.frequency.linearRampToValueAtTime(f,s/1e3),this.filter.frequency.linearRampToValueAtTime(l,o/1e3)}this.bufferSource.noteOn(this.noteOnTime/1e3)},noteOff:function(e){var t,n;t=e+this.ampRelease,n=e+this.filterRelease,this.amp.gain.cancelScheduledValues(e/1e3),this.amp.gain.setValueAtTime(this.ampSustainValue,e/1e3),this.amp.gain.linearRampToValueAtTime(0,t/1e3),this.filter&&(this.filter.frequency.cancelScheduledValues(e/1e3),this.filter.frequency.setValueAtTime(this.filter.frequency.value,e/1e3),this.filter.frequency.linearRampToValueAtTime(this.filterFrequency,n/1e3)),this.bufferSource.noteOff(t/1e3),this.disposeTime=t/1e3,this.noteOffSent=!0}};e.registerInstance(h,"sampler",u)}),dmaf("timePatternPlayer",["DMAF","TimeManager","InstanceManager","Instance","Assets","Utils"],function(e,t,n,r,i){function s(){this.activePatterns=[],this.running=!1}s.prototype=Object.create(r,{init:{value:function(){}},onAction:{value:function(e,n){var r=e.split("."),i=r[1].toLowerCase(),s=r[0];this[i]&&this[i](s,n),this.running||(this.running=!0,t.addFrameListener(this.instanceId,this.checkPatterns,this))}},start:{value:function(e,t){var n=i.getAsset("timePattern",e);n?(-1===this.activePatterns.indexOf(n)?this.activePatterns.push(n):dmaf.log&&console.log("Time Pattern",e,"is already active!"),n.startTime=t):dmaf.log&&console.log("No time pattern with id ",e,"exists.")}},stop:{value:function(t){var n,r=e.getAsset("timePattern",t);r?("DEFAULT"===this.behavior&&r.reset(),n=this.activePatterns.indexOf(r),-1!==n&&this.activePatterns.splice(n,1)):dmaf.log&&console.log("No time pattern with id ",t,"exists.")}},checkPatterns:{value:function(){if(!this.activePatterns.length)return this.running=!1,t.removeFrameListener(this.instanceId);for(var e=0;this.activePatterns.length>e;e++)this.activePatterns[e].executeEvents(this.behavior)&&this.activePatterns.splice(e--,1)[0].reset()}}}),e.registerInstance("player","timePatternPlayer",s)}),dmaf("ActionManager",["DMAF","Action"],function(e,t){var n=!1;return{triggers:{},populate:function(){for(var t,n=0,r=e.Settings.actions.length;r>n;n++)this.addAction(e.Settings.actions[n]);dmaf.log&&console.log("dmaf successfully loaded",r,"actions."),t=this.triggers.preload_assets,e.resolveListeners(),t&&t.length?(dmaf.log&&console.log("dmaf is now preloading",t.length,"assets"),dmaf.addEventListener("progress_event",this.readyCheck,this),this.onEvent("preload_assets")):this.readyCheck(100)},stop:function(){n=!0},onEvent:function(t,r,s){var o,u=this.triggers[t],a=r||1e3*e.context.currentTime;if(n=!1,u&&u.length)for(var f=0,l=u.length;l>f&&(o=u[f].delay?u[f].delay:0,u[f].actionProperties.delay&&(o+=u[f].actionProperties.delay),u[f].execute(t,a+o,s),!n);f++);},readyCheck:function r(t){100===t&&(dmaf.log&&console.log("dmaf has finished all preloads."),dmaf.removeEventListener("progress_event",r),this.onEvent("init_routing"),this.onEvent("dmaf_ready"),dmaf.active=!0,dmaf.log&&console.log("dispatching dmaf_ready"),e.dispatch("dmaf_ready"),e.resolveInput(),dmaf.log&&console.log("dmaf is now active!"))},addAction:function(n){if(!e[n.type]||!e[n.type][n.id])return dmaf.log&&console.log("DMAF Could not find module of type",n.type,"with id",n.id,"check the config.xml to make sure you've included this module."),void 0;for(var r,i=new t(n),s=0,o=i.triggers.length;o>s;s++)r=i.triggers[s],this.triggers[r]=this.triggers[r]||[],this.triggers[r].push(i)}}}),dmaf("Assets",["DMAF","ActionManager"],function(e,t){var n=e.Assets={beatPattern:{},sampleMap:{},buffer:{},timePattern:{},loadsInProgress:0,loadTotals:{},loadPercents:{},listenForLoads:function(e){if(void 0===this.loadTotals[e]){var n=t.triggers[e];if(n.length){n=n.slice(0).filter(function(e){return"assetController"===e.type}),this.loadTotals[e]=this.loadPercents[e]=0;for(var r=0,i=n.length;i>r;r++)this.loadTotals[e]+=n[r].actionProperties.files.length}}},getAsset:function(e,t){return this[e]&&this[e][t]?this[e][t]:(dmaf.log&&console.log("DMAF couldn't find asset",e,t),null)},setAsset:function(e,t,n){this[e]=this[e]||{},this[e][t]=n}};return n}),dmaf("InstanceManager",[],function(){function e(e){this.activeInstances={},this.constructor=e}return e.prototype.getInstance=function(e){return this.activeInstances[e]},e.prototype.removeInstance=function(e){return delete this.activeInstances[e]},e.prototype.addInstance=function(e){this.activeInstances[e.instanceId]=e},e.prototype.createInstance=function(e){var t=new this.constructor(e);return t.setInitProperties?(t.setInitProperties(e).init(e),this.addInstance(t),t):console.log(t)},e}),dmaf("TimeManager",["DMAF"],function(e){function t(){if(!o.length)return u=!1,void 0;for(r=1e3*a.currentTime,i=0;o.length>i;i++)o[i].callback.call(o[i].context);e.lastTime=e.currentTime,e.currentTime=e.context.currentTime,e.lastTime===e.currentTime&&console.error("Dirty context time!"),setTimeout(t,30)}function n(e){for(var t=o.length;t--;)if(o[t].id===e)return!0;return!1}var r,i,s=Array.prototype.slice,o=[],u=!1,a=e.context;return e.preListen=70,e.lastTime=0,e.currentTime=-1,{checkFunctionTime:function(t,n,r,i){var o,u,a,f=s.call(arguments,4);i=i||e,t>=1e3*e.context.currentTime+e.preListen?(o=function(){r.splice(r.indexOf(u),1),n.apply(i,f)},a=t-Math.floor(1e3*e.context.currentTime)-e.preListen,u=setTimeout(o,a),r.push(u)):n.apply(i,f)},dropPendingArray:function(e){for(;e.length;)clearTimeout(e.pop())},addFrameListener:function(r,i,s){return n(r)?(dmaf.log&&console.log("That frame listener is already running!",r),void 0):(o.push({callback:i,context:s||e,id:r}),u||(u=!0,t()),void 0)},removeFrameListener:function(e){for(var t=o.length;t--;)if(o[t].id===e)return o.splice(t,1),!0;return!1}}}),dmaf("parseDescriptors",["Utils","DMAF"],function(e,t){function n(t){for(var n,r=t.attributes,i={},s=0,o=r.length;o>s;s++)n=r[s].nodeName,e.propertyModel[n]&&(i[n]=e.fromString(e.propertyModel[n],r[s].value,t));return i}var r="getElementsByTagName",i="getAttribute";return function(s){var o,u,f,l,c,h=s[r]("descriptor"),p={validActions:[],validTypes:[]};return e.each(h,function(t,s){s[i]&&(c=s[i]("id"),l=s[i]("type"),f=s[i]("class"),p[f]=p[f]||{},p[f][l]=p[f][l]||{},p[f][l][c]=u=p[f][l][c]||{},p[f][l][c].type=l,p[f][l][c].id=c,p[f][l].type=l,"action"===f&&p.validActions.push(c),"type"===f&&p.validTypes.push(c),o=s[r]("property"),e.each(o,function(e,t){t[i]&&(u[t[i]("name")]=n(t))}))}),t.Settings||(t.Settings={}),t.Settings.descriptors=p,p}}),dmaf("parseMidi",["Assets","timePattern","beatPattern"],function(e,t,n){function r(e,t,n){this.absoluteTime=t+e.readVariableLengthInt();var r=e.read8BitInt();240==(240&r)?this.getMetaEvent(e,r):this.getChannelEvent(e,r,n)}function i(e){this.pointer=0,this.midiString=e}function s(e){i.call(this,e.split("").map(f).join("")),this.tracks=[],this.chunk={},this.lastEventType=0,this.getNextChunk("MThd").readHeader().getTracks()}function o(n,r){var i,s,o,u,f,c,h,p,d,v,m;for(c=0,h=n.trackCount;h>c;c++){for(u=n.tracks[c],i=u[0].text||r+c+"",trigger=u[1].text||r+c+"",o=[],p=0,d=u.length;d>p;p++)if("setTempo"===u[p].subtype){m=6e7/u[p].microsecondsPerBeat;break}for(p=0,d=u.length;d>p;p++)if("noteOn"===u[p].subtype){for(f=u[p],f.type=f.subtype,f.trigger=trigger,v=p;d>v&&!a(u[v],f);v++);f.absoluteTime=6e4*f.absoluteTime/(n.ticksPerBeat*m)+1,f.duration=6e4*f.duration/(n.ticksPerBeat*m),o.push(f)}s=new t(i,o),e.setAsset("timePattern",i,s)}}function u(t,r){var i,s,o,u,f,c,h,p,d,v,m,g;for(c=1,h=t.trackCount;h>c;c++){for(u=t.tracks[c],i=u[0].text||r+c+"",s=u[1].text||r+c+"",o=new n(i,1),p=2,d=u.length;d>p;p++)if("noteOn"===u[p].subtype||"controller"===u[p].subtype){for(f=u[p],f.type=f.subtype,v=Math.floor(f.absoluteTime/t.beatLengthInTicks),m=Math.floor(f.absoluteTime-v*t.beatLengthInTicks),g=p;d>g&&!a(u[g],f);g++);o.addEvent(s,v+1,m+1,f)}e.setAsset("beatPattern",i,o)}}function a(e,t){var n=("noteOn"===e.subtype||"noteOff"===e.subtype)&&e.subtype;return n&&e.midiNote===t.midiNote?"noteOn"===n&&!e.velocity||"noteOff"===n?(t.duration=e.absoluteTime-t.absoluteTime,t.duration):void 0:!1}function f(e){return String.fromCharCode(255&e.charCodeAt(0))}return r.prototype={getMetaEvent:function(e,t){var n,r;if(255==t){switch(this.type="meta",r=e.read8BitInt(),n=e.readVariableLengthInt(),r){case 0:if(this.subtype="sequenceNumber",2!=n)return;return this.number=e.read16BitInt(),void 0;case 1:return this.subtype="text",this.text=e.readTo(n),void 0;case 2:return this.subtype="copyrightNotice",this.text=e.readTo(n),void 0;case 3:return this.subtype="trackName",this.text=e.readTo(n),void 0;case 4:return this.subtype="instrumentName",this.text=e.readTo(n),void 0;case 5:return this.subtype="lyrics",this.text=e.readTo(n),void 0;case 6:return this.subtype="marker",this.text=e.readTo(n),void 0;case 7:return this.subtype="cuePoint",this.text=e.readTo(n),void 0;case 32:if(this.subtype="midiChannelPrefix",1!==n)return;return this.channel=e.read8BitInt(),void 0;case 47:return this.subtype="endOfTrack",void 0;case 81:if(this.subtype="setTempo",3!=n)return;return this.microsecondsPerBeat=(e.read8BitInt()<<16)+(e.read8BitInt()<<8)+e.read8BitInt(),void 0;case 84:if(this.subtype="smpteOffset",5!=n)return;var i=e.read8BitInt();return this.frameRate={0:24,32:25,64:29,96:30}[96&i],this.hour=31&i,this.min=e.read8BitInt(),this.sec=e.read8BitInt(),this.frame=e.read8BitInt(),this.subframe=e.read8BitInt(),void 0;case 88:if(this.subtype="timeSignature",4!==n)return;return this.numerator=e.read8BitInt(),this.denominator=Math.pow(2,e.read8BitInt()),this.metronome=e.read8BitInt(),this.thirtyseconds=e.read8BitInt(),void 0;case 89:if(this.subtype="keySignature",2!==n)return;return this.key=e.read8BitInt(),this.scale=e.read8BitInt(),void 0;case 127:return this.subtype="sequencerSpecific",this.data=e.readTo(n),void 0;default:return this.subtype="unknown",this.data=e.readTo(n),void 0}return this.data=e.readTo(n),void 0}return 240==t?(this.type="sysEx",n=e.readVariableLengthInt(),this.data=e.readTo(n),void 0):247==t?(this.type="dividedSysEx",n=e.readVariableLengthInt(),this.data=e.readTo(n),void 0):(this.type="unknown",n=e.readVariableLengthInt(),this.data=e.readTo(n),console.error("unknown MIDI event type byte of length"+n),void 0)},getChannelEvent:function(e,t,n){var r,i;switch(0===(128&t)?(i=t,t=n.lastEventType):(i=e.read8BitInt(),n.lastEventType=t),r=t>>4,this.channel=15&t,this.type="channel",r){case 8:this.subtype="noteOff",this.midiNote=i,this.velocity=e.read8BitInt();break;case 9:this.midiNote=i,this.velocity=e.read8BitInt(),this.subtype=0===this.velocity?"noteOff":"noteOn";break;case 10:this.subtype="noteAftertouch",this.midiNote=i,this.amount=e.read8BitInt();break;case 11:this.subtype="controller",this.controllerType=i,this.value=e.read8BitInt();break;case 12:this.subtype="programChange",this.programNumber=i;break;case 13:this.subtype="channelAftertouch",this.amount=i;break;case 14:this.subtype="pitchBend",this.value=i+(e.read8BitInt()<<7);break;default:this.subtype="unknown",console.error("Unrecognised MIDI event type: "+r)}}},i.prototype={read32BitInt:function(){var e=(this.midiString.charCodeAt(this.pointer)<<24)+(this.midiString.charCodeAt(this.pointer+1)<<16)+(this.midiString.charCodeAt(this.pointer+2)<<8)+this.midiString.charCodeAt(this.pointer+3);return this.pointer+=4,e},read16BitInt:function(){var e=(this.midiString.charCodeAt(this.pointer)<<8)+this.midiString.charCodeAt(this.pointer+1);return this.pointer+=2,e},read8BitInt:function(){var e=this.midiString.charCodeAt(this.pointer);return this.pointer+=1,e},readTo:function(e){var t=this.midiString.substr(this.pointer,e);return this.pointer+=e,t},endOfFile:function(){return this.pointer>=this.midiString.length},readVariableLengthInt:function(){for(var e=0;;){var t=this.read8BitInt();if(!(128&t))return e+t;e+=127&t,e<<=7}}},s.prototype=Object.create(i.prototype,{readHeader:{value:function(){var e=new i(this.chunk.data);return this.formatType=e.read16BitInt(),this.trackCount=e.read16BitInt(),this.ticksPerBeat=e.read16BitInt(),32768&this.ticksPerBeat&&(this.ticksPerBeat=480,dmaf.log&&console.log("Time division in SMPTE, defaulting to 480 ticks per beat")),this.beatLengthInTicks=this.ticksPerBeat/4,this}},getTracks:{value:function(){for(var e,t,n,s=0,o=this.trackCount;o>s;s++)for(this.tracks[s]=[],t=0,this.getNextChunk("MTrk"),e=new i(this.chunk.data);!e.endOfFile();)n=new r(e,t,this),this.tracks[s].push(n),t=n.absoluteTime;return this}},getNextChunk:{value:function(e){return this.chunk.id=this.readTo(4),this.chunk.id!==e?(console.log("MidiParser expected",e,"but found",this.chunk.id),this):(this.chunk.length=this.read32BitInt(),this.chunk.data=this.readTo(this.chunk.length),this)}}}),function(e,t,n){var r=new s(e);switch(t){case"beatPattern":u(r,n);break;case"timePattern":o(r,n);break;default:u(r,n)}}}),dmaf("parseSampleMap",["Assets","Utils"],function(e,t){function n(e,t){console.error("Malformed Samplemap!",e||"No information about this error!"),console.error(t)}function r(e,t){return t[s](e)||n("Could not find required property "+e,t)}var i="getElementsByTagName",s="getAttribute";return function(u){var f,l,c,h=u[i]("samplemap"),p=["sound","root","low","hi","vol"];t.each(h,function(u,h){return l=h[s]("name"),f=h[i]("range"),c={},"string"!=typeof l?n("name is undefined"):f&&f.length?(t.each(f,function(e,n){var i=c["range_"+e]={};t.each(p,function(e,t){i[t]=r(t,n)})}),e.setAsset("sampleMap",l,c),void 0):n("Couldn't find ranges for "+l)})}}),dmaf("beatPattern",["DMAF","ActionManager","Assets"],function(e,t,n){function r(e,t,n,r){this.eventName=e,this.beat=t,this.tick=n||1,this.data=r}function i(e,t){this.events={},this.patternId=e,this.startPosition=t||1,this.endPosition=0}return r.prototype.execute=function(e,n){var r=Object.create(this.data);e=Math.floor(e+(this.tick-1)*(n/120)),r.duration=e+r.duration*(n/120)/1e3-e,r.duration*=1e3,t.onEvent(this.eventName,e,r)},i.prototype.addEvent=function(e,t,n,i){this.events[t]=this.events[t]||[],this.events[t].push(new r(e,t,n,i)),t+1>this.endPosition&&(this.endPosition=t+1)},n.setAsset("beatPattern","empty_pattern",new i("empty_pattern",1)),i}),dmaf("beatPatternInstance",["beatPosition"],function(e){function t(t,n){if(!n.beatPattern)return console.error("Found no BeatPattern for channel",n.channel,". Please check MIDI file."),this.ERROR=!0,void 0;if(this.addAtSongPosition=n.addAtSongPosition,this.currentBeat=n.startPatternAtBeat,this.replaceActive=n.replaceActive,this.clearPosition=n.clearPosition,this.setAsCurrent=n.setAsCurrent,this.beatPattern=n.beatPattern,this.patternId=n.patternId,this.channel=n.channel,this.loop=n.loop,this.player=t,this.loop)n.loopLength?(this.loopLength=n.loopLength,this.removeAtSongPosition=new e(1/0,1,this.player.beatsPerBar)):dmaf.log&&console.error("You must specify a loopLength for pattern "+this.patternId+" if loop is set to true."),this.currentBeat===this.loopLength&&(this.currentBeat=1);else{var r=this.beatPattern.endPosition-this.currentBeat;this.removeAtSongPosition=this.addAtSongPosition.clone(),this.removeAtSongPosition.addOffset({bar:0,beats:r})}}return t.prototype.gotoNextBeat=function(){this.currentBeat++,this.loop&&this.currentBeat>this.loopLength&&(this.currentBeat=1)},t.prototype.executeEvents=function(e,t){var n=this.beatPattern.events[this.currentBeat];if(n)for(var r=0,i=n.length;i>r;r++)n[r].execute(e,t)},t}),dmaf("beatPosition",[],function(){function e(e,t,n){this.bar=void 0===e?1:e,this.beat=void 0===t?1:t,this.beatsPerBar=void 0===n?16:n}return e.prototype.getInBeats=function(){return(this.bar-1)*this.beatsPerBar+this.beat},e.prototype.gotoNextBeat=function(){this.beat===this.beatsPerBar?(this.bar++,this.beat=1):this.beat++},e.prototype.addOffset=function(e){for(this.beat+=e.beat;this.beat>this.beatsPerBar;)this.bar++,this.beat-=this.beatsPerBar;this.bar+=e.bar},e.prototype.clone=function(){return new e(this.bar,this.beat,this.beatsPerBar)},e}),dmaf("timePattern",["DMAF","ActionManager","Utils"],function(e,t,n){function r(e,t){this.patternId=e,this.events=t,this.startTime=-1,this.lastExecutedEventTime=-1,this.remove=!1}return r.prototype={reset:function(){this.startTime=-1,this.lastExecutedEventTime=-1,this.remove=!1},executeEvents:function(t){var n=1e3*e.context.currentTime-this.startTime,r=-1;switch(t){case"LINEAR":this.executeLinear(n,r);break;case"DEFAULT":this.executeDefault(n,r)}return this.remove},executeLinear:function(r){var s,o;for(s=0,o=this.events.length;o>s;s++)this.events[s].absoluteTime>this.lastExecutedEventTime&&r>this.events[s].absoluteTime-e.preListen&&(t.onEvent(this.events[s].trigger,this.startTime+this.events[s].absoluteTime,n.clone(this.events[s])),this.lastExecutedEventTime=this.events[s].absoluteTime);r>this.events[o-1].absoluteTime+300&&(this.remove=!0)},executeDefault:function(r,s){var o,u;if(-1===this.lastExecutedEventTime){for(o=0,u=this.events.length;u>o;o++)r>this.events[o].absoluteTime-e.preListen&&(t.onEvent(this.events[o].trigger,this.startTime+this.events[o].absoluteTime,n.clone(this.events[o])),s=this.events[o].absoluteTime);this.lastExecutedEventTime=s,r>this.events[u-1].absoluteTime+300&&(this.remove=!0)}else this.executeLinear(r,s)}},r}),dmaf("Iterator",[],function(){function e(e,n){this.index=-1,this.array=e,this.getNext=t[n],this.A=e.slice(0),this.B=[]}var t={ROUND_ROBIN:function(){return this.index++,this.index%=this.array.length,this.array[this.index]},RANDOM_FIRST:function(){return-1===this.index?this.array[Math.floor(Math.random()*this.array.length)]:this.array[++this.index]},RANDOM:function(){return this.array[Math.floor(Math.random()*this.array.length)]},SHUFFLE:function(){var e;this.A.length||(this.A=this.array.slice(0),this.B=[]);do e=Math.floor(Math.random()*this.A.length);while(this.A[e]===this.previous);return this.B.push(this.A.splice(e,1)[0]),this.previous=this.B[this.B.length-1],this.previous}};return e}),dmaf("Parse",["DMAF","Assets","parseSampleMap","parseMidi"],function(e,t,n,r){var i={midi:r,samplemap:n};return function(t){var n=Array.prototype.slice.call(arguments,1);return i[t]?i[t].apply(e,n):(dmaf.log&&console.log("DMAF.parse: invalid type",t),null)}}),dmaf("parser",["DMAF","Utils","parseDescriptors"],function(e,t,n){function r(e,t){var n,r,i,s=0;if(e instanceof Array)for(s=0,i=e.length;i>s&&(!e[s]||!t(s,e[s]));s++);else if("object"==typeof e)for(n=Object.keys(e),s=0,i=n.length;i>s&&(r=n[s],"length"===r||!e[r]||!t(r,e[r]));s++);else console.error("Not array or object",typeof e,e)}function i(e){var t=[];return e||console.error("Missing descriptor"),r(e,function(e,n){"array"===n.type&&t.push(n)}),t}function s(e,t){return r(t,function(n){(void 0===e[n]||"undefined"===e[n])&&(e[n]=t[n][m])}),e}function o(e){var t;return r(v.action,function(n,i){return r(i,function(n,r){return n===e?t=r:void 0}),t}),t||console.error("Could not find action with Id of",e)}function u(e){return Object.keys(v.type[e]).filter(function(e){return"type"!==e})}function a(e){return e.replace(/\s+/g,"")}function f(e,t,n){var o=e[g]("properties"),u=i(t),a={};return r(o,function(e,n){n.localName&&l(a,n,t)}),r(u,function(t,n){if(e[g]){var r=e[g](n.name)[0]||[];a[n.name]=r?c(r,n.valueType):[]}else a[n.name]=[]}),s(a,t,n)}function l(e,n,i){for(var s=n.attributes,o=0,u=s.length;u>o;o++)if(void 0===i[s[o].localName]&&"triggers"!==s[o].localName&&"delay"!==s[o].localName)return console.error("Invalid attribute",s[o].localName,"check spelling in descriptors");r(i,function(r,i){n.hasAttribute(r)&&(value=n[y](r),/\:/.test(value)&&!/target/.test(r)?(e._dynamicValues=e._dynamicValues||[],e._dynamicValues.push({key:r,string:value}),e[r]=i[m]):(value=t.fromString(i.type,value,i),e[r]=p(i,value)))})}function c(e,t){if(e[g]){var n=u(t),s=[],o=[],a=v.type[t];return r(n,function(t,n){var i=e[g](n);r(i,function(e,t){t&&t.localName&&s.push(t)})}),r(s,function(t,n){if(n.localName&&a[n.localName]){var s={id:n.localName},u=i(a[s.id]);l(s,n,a[s.id]),r(u,function(t,n){var r=e[g](n.name)[0];s[n.name]=r&&r[g]?c(r,n.valueType):[]}),o.push(s)}}),o}return[]}function h(e,t){return e>t.max&&(console.log(e,"is out of range. constraining",t.name,"to:",t.max),e=t.max),t.min>e&&(console.log(e,"is out of range. constraining",t.name,"to:",t.min),e=t.min),e}function p(e,t){var n;if(e&&void 0!==e.type||console.warn("DMAF Verification Error: Malformed descriptor!"),void 0===t)return e[m];switch(e.type){case"int":if(!b.test(t)){n=!0;break}t=h(t,e);break;case"float":if(isNaN(t)){n=!0;break}t=h(t,e);break;case"string":"undefined"===t&&(t=void 0),"string"!=typeof t&&(n=!0);break;case"list":n=!(t instanceof Array);break;case"enum":e.values&&e.values instanceof Array?-1===e.values.indexOf(t)&&(console.log(t,"is not valid enum for",e.name),n=!0):(console.log("Malformed descriptors object",e.name),n=!0);break;case"boolean":n="boolean"!=typeof t;break;default:console.warn("Malformed defaults object. Please check the descriptors.xml")}return n?(console.warn(t,"is not valid for",e.name),console.warn("Defaulting",e.name,"to",e[m]),e[m]):t}function d(t){var n=t[g]("actions")[0].childNodes,i=[],s=[];return v=e.Settings.descriptors,r(n,function(e,t){t&&t.localName&&t[g]&&(-1!==v.validActions.indexOf(t.localName)?i.push(t):console.error("Unrecognized action!",t.localName,"check spelling."))}),r(i,function(e,t){if(t.localName&&t[g]){var n=t.localName,r=o(n),i=f(t,r,t.localName),u=r.type,l=t[y]("triggers"),c=t[y]("delay"),h=t[y]("instanceId");if(Settings={},!l)return console.error("Action",u,n,i.instanceId,"has no triggers!"),!0;l=l.split(",").map(a),s.push({type:u,id:t.localName,triggers:l,actionProperties:i,delay:parseInt(c,10)||0,instanceId:h})}}),s}var v,m="default",g="getElementsByTagName",y="getAttribute",b=/^\s*-?[0-9]{1,10}\s*$/,w={};return w.parseActions=d,w.parseDescriptors=n,w}),dmaf("Utils",[],function(){var e={cflat:-1,c:0,csharp:1,dflat:1,d:2,dsharp:3,eflat:3,e:4,esharp:5,fflat:4,f:5,fsharp:6,gflat:6,g:7,gsharp:8,aflat:8,a:9,asharp:10,bflat:10,b:11,bsharp:12},t={automatable:"boolean","default":"fromType",valueType:"string",value:"fromType",min:"fromType",max:"fromType",name:"string",type:"string",values:"list",unit:"string",src:"string"},n="getAttribute";return{ajax:function(e,t,n){function r(){if(4===this.readyState){var t,r=n&&n.context||null,f=this.status>=200&&300>this.status||304===this.status;if(!f||!this.response)return s.onerror=function(){},i();if(n&&n.expectType&&typeof this.response!==n.expectType)return i();if(t=n.responseXML?this.responseXML:this.response,n.responseXML&&!this.responseXML)return dmaf.log&&console.log("Problem with XMLHttpRequest: XML is missing or malformed.",e),i();for(var l=0,c=u.length;c>l;l++)o.unshift(t),t=u[l].apply(r,o)}}var i,s=new XMLHttpRequest,o=[],u=[t];n?(n.override&&s.overrideMimeType(n.override),n.responseType&&(s.responseType=n.responseType),n.chain&&(u=u.concat(n.chain)),n.args&&(o=o.concat(n.args))):n={},i=n.fail?n.fail:function(){dmaf.log&&console.log("DMAF ajax: Problem with request",e)},s.onerror=i,s.onreadystatechange=r,s.open("GET",e,!0),s.send()},clone:function(e){return"object"!=typeof e?{}:JSON.parse(JSON.stringify(e))},calculateAverage:function(e){for(var t=0,n=0,r=e.length;r>n;n++)t+=e[n];return t/e.length},dbToJSVolume:function(e){var t=Math.max(0,Math.round(100*Math.pow(2,e/6))/100);return Math.min(1,t)},dbToWAVolume:function(e){return Math.max(0,Math.floor(100*Math.pow(2,e/6))/100)},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},each:function(e,t){var n,r,i,s=0;if(e instanceof Array)for(s=0,i=e.length;i>s&&(!e[s]||!t(s,e[s]));s++);else if("object"==typeof e)for(n=Object.keys(e),s=0,i=n.length;i>s&&(r=n[s],"length"===r||!e[r]||!t(r,e[r]));s++);else console.error("Not array or object",typeof e,e)},fromString:function(e,t,r){if(t===void 0||"undefined"===t)return void 0;switch(e){case"string":return t;case"boolean":return"true"===t;case"int":return parseInt(t,10);case"float":return parseFloat(t);case"list":return t.split(",");case"enum":return t;case"fromType":return this.fromString(r[n]("type"),t,r);default:console.error("DMAF convert string to value",e,t,r)}},MIDIToFrequency:function(e){return 8.1757989156*Math.pow(2,e/12)},parseProperty:function(e){for(var n,r=e.attributes,i={},s=0,o=r.length;o>s;s++)n=r[s].nodeName,t[n]&&(i[n]=fromString(t[n],r[s].value,e));return i},propertyModel:t,removeWhiteSpace:function(e){return e.replace(/\s+/g,"")},toMIDINote:function(t){var n,r,i,s;return"#"===t[1]||"s"===t[1].toLowerCase()?(r=t[0].toLowerCase()+"sharp",s=2):"b"===t[1]?(r=t[0].toLowerCase()+"flat",s=2):(r=t[0].toLowerCase(),s=1),r=e[r],i="-"===t[s]?12*(0-parseInt(t[s+1],10)+2):12*(parseInt(t[s],10)+2),n=i+r}}}),dmaf("controller",["DMAF","Instance","ActionManager"],function(e,t,n){function r(e,t){return e+t}function i(e,t){return e-t}function s(e){return Math.abs(e)}function o(e){return y.push(e),y.length>20&&y.shift(),y.reduce(r,0)/y.length}function u(e){return o(Math.max.apply(Math,[e.x,e.y,e.z].map(s).sort(i)))}function a(){var e=c.alpha;c.beta,c.gamma;var t=Math.floor(e/90),r=u(p);r>g&&(r=g),m=Math.floor(5.999*(r/g)),v[t]&&t!==d&&(console.log("Triggering:",v[t]),n.onEvent(v[t]),d=t),setTimeout(a,100)}function f(){l=e.getInstance("customCode:data").obj,c=l.rotation,p=l.acceleration,h=l.noGravity}var l,c,h,p,d,v={0:"p1",1:"p2",2:"p3",3:"p4"},m=1,g=30,y=[];f.prototype=Object.create(t,{onAction:{value:function(e){switch(e){case"data.CREATE":a();break;case"drums1":2>m&&n.stop();break;case"drums2":3>m&&n.stop();break;case"drums3":4>m&&n.stop();break;case"pad1":break;case"pad2":break;case"harpgsp":2>m&&n.stop();break;case"vox":3>m&&n.stop();break;case"moog_bass":2>m&&n.stop();break;case"chopped_bass1":3>m&&n.stop();break;case"chopped_bass2":4>m&&n.stop();break;case"oberheim":4>m&&n.stop();break;case"synth_arp":5>m&&n.stop();break;default:}}}}),e.registerInstance("customCode","controller",f)});